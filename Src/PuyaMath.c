/**
  ******************************************************************************
  * @file    PuyaMath.c
  * @author  MCU Application Team
  * @Version V1.0.0
  * @Date    2023-03-01
  * @brief   BLDC FOC Sensorless under 1R Sensing Current
  ******************************************************************************
**/

/************************************************************************
 Included File:
*************************************************************************/
#include "main.h"
#include "py32f072_hal.h"
#include "py32f072_hal_opa.h"
#include "py32f072_hal_opa_ex.h"

SWORD man_swVd, man_swVq, man_swValfa, man_swVbeta, man_swVa, man_swVb, man_swVc;

const signed int ArWe[11] = { //0 to 19968
    0	,//	0
    2048	,//	1
    4096	,//	2
    6144	,//	3
    8192	,//	4
    10240	,//	5
    12288	,//	6
    14336	,//	7
    16384	,//	8
    18432	,//	9
    20480	,//	10
};



const signed int Tabls2[181] = {
    0 	,	//	0
    1 	,	//	1
    5 	,	//	2
    11 	,	//	3
    20 	,	//	4
    31 	,	//	5
    45 	,	//	6
    61 	,	//	7
    80 	,	//	8
    101 	,	//	9
    124 	,	//	10
    151 	,	//	11
    179 	,	//	12
    210 	,	//	13
    243 	,	//	14
    279 	,	//	15
    317 	,	//	16
    358 	,	//	17
    401 	,	//	18
    446 	,	//	19
    494 	,	//	20
    544 	,	//	21
    597 	,	//	22
    651 	,	//	23
    708 	,	//	24
    768 	,	//	25
    829 	,	//	26
    893 	,	//	27
    959 	,	//	28
    1027 	,	//	29
    1098 	,	//	30
    1170 	,	//	31
    1245 	,	//	32
    1322 	,	//	33
    1401 	,	//	34
    1482 	,	//	35
    1565 	,	//	36
    1650 	,	//	37
    1737 	,	//	38
    1826 	,	//	39
    1917 	,	//	40
    2009 	,	//	41
    2104 	,	//	42
    2201 	,	//	43
    2299 	,	//	44
    2399 	,	//	45
    2501 	,	//	46
    2605 	,	//	47
    2710 	,	//	48
    2818 	,	//	49
    2926 	,	//	50
    3037 	,	//	51
    3149 	,	//	52
    3262 	,	//	53
    3377 	,	//	54
    3493 	,	//	55
    3611 	,	//	56
    3730 	,	//	57
    3851 	,	//	58
    3973 	,	//	59
    4096 	,	//	60
    4220 	,	//	61
    4346 	,	//	62
    4473 	,	//	63
    4601 	,	//	64
    4730 	,	//	65
    4860 	,	//	66
    4991 	,	//	67
    5123 	,	//	68
    5256 	,	//	69
    5390 	,	//	70
    5525 	,	//	71
    5661 	,	//	72
    5797 	,	//	73
    5934 	,	//	74
    6072 	,	//	75
    6210 	,	//	76
    6349 	,	//	77
    6489 	,	//	78
    6629 	,	//	79
    6769 	,	//	80
    6910 	,	//	81
    7052 	,	//	82
    7194 	,	//	83
    7336 	,	//	84
    7478 	,	//	85
    7621 	,	//	86
    7763 	,	//	87
    7906 	,	//	88
    8049 	,	//	89
    8192 	,	//	90
    8335 	,	//	91
    8478 	,	//	92
    8621 	,	//	93
    8763 	,	//	94
    8906 	,	//	95
    9048 	,	//	96
    9190 	,	//	97
    9332 	,	//	98
    9474 	,	//	99
    9615 	,	//	100
    9755 	,	//	101
    9895 	,	//	102
    10035 	,	//	103
    10174 	,	//	104
    10312 	,	//	105
    10450 	,	//	106
    10587 	,	//	107
    10723 	,	//	108
    10859 	,	//	109
    10994 	,	//	110
    11128 	,	//	111
    11261 	,	//	112
    11393 	,	//	113
    11524 	,	//	114
    11654 	,	//	115
    11783 	,	//	116
    11911 	,	//	117
    12038 	,	//	118
    12164 	,	//	119
    12288 	,	//	120
    12411 	,	//	121
    12533 	,	//	122
    12654 	,	//	123
    12773 	,	//	124
    12891 	,	//	125
    13007 	,	//	126
    13122 	,	//	127
    13235 	,	//	128
    13347 	,	//	129
    13458 	,	//	130
    13566 	,	//	131
    13674 	,	//	132
    13779 	,	//	133
    13883 	,	//	134
    13985 	,	//	135
    14085 	,	//	136
    14183 	,	//	137
    14280 	,	//	138
    14375 	,	//	139
    14467 	,	//	140
    14558 	,	//	141
    14647 	,	//	142
    14734 	,	//	143
    14819 	,	//	144
    14902 	,	//	145
    14983 	,	//	146
    15062 	,	//	147
    15139 	,	//	148
    15214 	,	//	149
    15286 	,	//	150
    15357 	,	//	151
    15425 	,	//	152
    15491 	,	//	153
    15555 	,	//	154
    15616 	,	//	155
    15676 	,	//	156
    15733 	,	//	157
    15787 	,	//	158
    15840 	,	//	159
    15890 	,	//	160
    15938 	,	//	161
    15983 	,	//	162
    16026 	,	//	163
    16067 	,	//	164
    16105 	,	//	165
    16141 	,	//	166
    16174 	,	//	167
    16205 	,	//	168
    16233 	,	//	169
    16260 	,	//	170
    16283 	,	//	171
    16304 	,	//	172
    16323 	,	//	173
    16339 	,	//	174
    16353 	,	//	175
    16364 	,	//	176
    16373 	,	//	177
    16379 	,	//	178
    16383 	,	//	179
    16384 	,	//	180
};

const signed int SqrtVs2SubVd2_1033[1033] = {
    30999	,//	-30		0
    30999	,//	-60		1
    30999	,//	-90		2
    30999	,//	-120		3
    30999	,//	-150		4
    30999	,//	-180		5
    30999	,//	-210		6
    30999	,//	-240		7
    30998	,//	-270		8
    30998	,//	-300		9
    30998	,//	-330		10
    30997	,//	-360		11
    30997	,//	-390		12
    30997	,//	-420		13
    30996	,//	-450		14
    30996	,//	-480		15
    30995	,//	-510		16
    30995	,//	-540		17
    30994	,//	-570		18
    30994	,//	-600		19
    30993	,//	-630		20
    30992	,//	-660		21
    30992	,//	-690		22
    30991	,//	-720		23
    30990	,//	-750		24
    30990	,//	-780		25
    30989	,//	-810		26
    30988	,//	-840		27
    30987	,//	-870		28
    30986	,//	-900		29
    30986	,//	-930		30
    30985	,//	-960		31
    30984	,//	-990		32
    30983	,//	-1020		33
    30982	,//	-1050		34
    30981	,//	-1080		35
    30980	,//	-1110		36
    30979	,//	-1140		37
    30977	,//	-1170		38
    30976	,//	-1200		39
    30975	,//	-1230		40
    30974	,//	-1260		41
    30973	,//	-1290		42
    30971	,//	-1320		43
    30970	,//	-1350		44
    30969	,//	-1380		45
    30967	,//	-1410		46
    30966	,//	-1440		47
    30965	,//	-1470		48
    30963	,//	-1500		49
    30962	,//	-1530		50
    30960	,//	-1560		51
    30959	,//	-1590		52
    30957	,//	-1620		53
    30956	,//	-1650		54
    30954	,//	-1680		55
    30952	,//	-1710		56
    30951	,//	-1740		57
    30949	,//	-1770		58
    30947	,//	-1800		59
    30945	,//	-1830		60
    30944	,//	-1860		61
    30942	,//	-1890		62
    30940	,//	-1920		63
    30938	,//	-1950		64
    30936	,//	-1980		65
    30934	,//	-2010		66
    30932	,//	-2040		67
    30930	,//	-2070		68
    30928	,//	-2100		69
    30926	,//	-2130		70
    30924	,//	-2160		71
    30922	,//	-2190		72
    30920	,//	-2220		73
    30918	,//	-2250		74
    30916	,//	-2280		75
    30913	,//	-2310		76
    30911	,//	-2340		77
    30909	,//	-2370		78
    30906	,//	-2400		79
    30904	,//	-2430		80
    30902	,//	-2460		81
    30899	,//	-2490		82
    30897	,//	-2520		83
    30894	,//	-2550		84
    30892	,//	-2580		85
    30889	,//	-2610		86
    30887	,//	-2640		87
    30884	,//	-2670		88
    30882	,//	-2700		89
    30879	,//	-2730		90
    30876	,//	-2760		91
    30874	,//	-2790		92
    30871	,//	-2820		93
    30868	,//	-2850		94
    30865	,//	-2880		95
    30863	,//	-2910		96
    30860	,//	-2940		97
    30857	,//	-2970		98
    30854	,//	-3000		99
    30851	,//	-3030		100
    30848	,//	-3060		101
    30845	,//	-3090		102
    30842	,//	-3120		103
    30839	,//	-3150		104
    30836	,//	-3180		105
    30833	,//	-3210		106
    30830	,//	-3240		107
    30827	,//	-3270		108
    30823	,//	-3300		109
    30820	,//	-3330		110
    30817	,//	-3360		111
    30814	,//	-3390		112
    30810	,//	-3420		113
    30807	,//	-3450		114
    30804	,//	-3480		115
    30800	,//	-3510		116
    30797	,//	-3540		117
    30793	,//	-3570		118
    30790	,//	-3600		119
    30786	,//	-3630		120
    30783	,//	-3660		121
    30779	,//	-3690		122
    30775	,//	-3720		123
    30772	,//	-3750		124
    30768	,//	-3780		125
    30764	,//	-3810		126
    30761	,//	-3840		127
    30757	,//	-3870		128
    30753	,//	-3900		129
    30749	,//	-3930		130
    30746	,//	-3960		131
    30742	,//	-3990		132
    30738	,//	-4020		133
    30734	,//	-4050		134
    30730	,//	-4080		135
    30726	,//	-4110		136
    30722	,//	-4140		137
    30718	,//	-4170		138
    30714	,//	-4200		139
    30710	,//	-4230		140
    30705	,//	-4260		141
    30701	,//	-4290		142
    30697	,//	-4320		143
    30693	,//	-4350		144
    30689	,//	-4380		145
    30684	,//	-4410		146
    30680	,//	-4440		147
    30676	,//	-4470		148
    30671	,//	-4500		149
    30667	,//	-4530		150
    30662	,//	-4560		151
    30658	,//	-4590		152
    30653	,//	-4620		153
    30649	,//	-4650		154
    30644	,//	-4680		155
    30640	,//	-4710		156
    30635	,//	-4740		157
    30630	,//	-4770		158
    30626	,//	-4800		159
    30621	,//	-4830		160
    30616	,//	-4860		161
    30611	,//	-4890		162
    30607	,//	-4920		163
    30602	,//	-4950		164
    30597	,//	-4980		165
    30592	,//	-5010		166
    30587	,//	-5040		167
    30582	,//	-5070		168
    30577	,//	-5100		169
    30572	,//	-5130		170
    30567	,//	-5160		171
    30562	,//	-5190		172
    30557	,//	-5220		173
    30552	,//	-5250		174
    30547	,//	-5280		175
    30541	,//	-5310		176
    30536	,//	-5340		177
    30531	,//	-5370		178
    30526	,//	-5400		179
    30520	,//	-5430		180
    30515	,//	-5460		181
    30509	,//	-5490		182
    30504	,//	-5520		183
    30499	,//	-5550		184
    30493	,//	-5580		185
    30488	,//	-5610		186
    30482	,//	-5640		187
    30477	,//	-5670		188
    30471	,//	-5700		189
    30465	,//	-5730		190
    30460	,//	-5760		191
    30454	,//	-5790		192
    30448	,//	-5820		193
    30443	,//	-5850		194
    30437	,//	-5880		195
    30431	,//	-5910		196
    30425	,//	-5940		197
    30419	,//	-5970		198
    30413	,//	-6000		199
    30407	,//	-6030		200
    30401	,//	-6060		201
    30395	,//	-6090		202
    30389	,//	-6120		203
    30383	,//	-6150		204
    30377	,//	-6180		205
    30371	,//	-6210		206
    30365	,//	-6240		207
    30359	,//	-6270		208
    30353	,//	-6300		209
    30346	,//	-6330		210
    30340	,//	-6360		211
    30334	,//	-6390		212
    30327	,//	-6420		213
    30321	,//	-6450		214
    30315	,//	-6480		215
    30308	,//	-6510		216
    30302	,//	-6540		217
    30295	,//	-6570		218
    30289	,//	-6600		219
    30282	,//	-6630		220
    30276	,//	-6660		221
    30269	,//	-6690		222
    30262	,//	-6720		223
    30256	,//	-6750		224
    30249	,//	-6780		225
    30242	,//	-6810		226
    30235	,//	-6840		227
    30229	,//	-6870		228
    30222	,//	-6900		229
    30215	,//	-6930		230
    30208	,//	-6960		231
    30201	,//	-6990		232
    30194	,//	-7020		233
    30187	,//	-7050		234
    30180	,//	-7080		235
    30173	,//	-7110		236
    30166	,//	-7140		237
    30159	,//	-7170		238
    30152	,//	-7200		239
    30145	,//	-7230		240
    30137	,//	-7260		241
    30130	,//	-7290		242
    30123	,//	-7320		243
    30116	,//	-7350		244
    30108	,//	-7380		245
    30101	,//	-7410		246
    30093	,//	-7440		247
    30086	,//	-7470		248
    30079	,//	-7500		249
    30071	,//	-7530		250
    30064	,//	-7560		251
    30056	,//	-7590		252
    30048	,//	-7620		253
    30041	,//	-7650		254
    30033	,//	-7680		255
    30025	,//	-7710		256
    30018	,//	-7740		257
    30010	,//	-7770		258
    30002	,//	-7800		259
    29994	,//	-7830		260
    29987	,//	-7860		261
    29979	,//	-7890		262
    29971	,//	-7920		263
    29963	,//	-7950		264
    29955	,//	-7980		265
    29947	,//	-8010		266
    29939	,//	-8040		267
    29931	,//	-8070		268
    29923	,//	-8100		269
    29914	,//	-8130		270
    29906	,//	-8160		271
    29898	,//	-8190		272
    29890	,//	-8220		273
    29882	,//	-8250		274
    29873	,//	-8280		275
    29865	,//	-8310		276
    29857	,//	-8340		277
    29848	,//	-8370		278
    29840	,//	-8400		279
    29831	,//	-8430		280
    29823	,//	-8460		281
    29814	,//	-8490		282
    29806	,//	-8520		283
    29797	,//	-8550		284
    29788	,//	-8580		285
    29780	,//	-8610		286
    29771	,//	-8640		287
    29762	,//	-8670		288
    29754	,//	-8700		289
    29745	,//	-8730		290
    29736	,//	-8760		291
    29727	,//	-8790		292
    29718	,//	-8820		293
    29709	,//	-8850		294
    29700	,//	-8880		295
    29691	,//	-8910		296
    29682	,//	-8940		297
    29673	,//	-8970		298
    29664	,//	-9000		299
    29655	,//	-9030		300
    29646	,//	-9060		301
    29637	,//	-9090		302
    29628	,//	-9120		303
    29618	,//	-9150		304
    29609	,//	-9180		305
    29600	,//	-9210		306
    29590	,//	-9240		307
    29581	,//	-9270		308
    29572	,//	-9300		309
    29562	,//	-9330		310
    29553	,//	-9360		311
    29543	,//	-9390		312
    29534	,//	-9420		313
    29524	,//	-9450		314
    29514	,//	-9480		315
    29505	,//	-9510		316
    29495	,//	-9540		317
    29485	,//	-9570		318
    29476	,//	-9600		319
    29466	,//	-9630		320
    29456	,//	-9660		321
    29446	,//	-9690		322
    29436	,//	-9720		323
    29426	,//	-9750		324
    29416	,//	-9780		325
    29406	,//	-9810		326
    29396	,//	-9840		327
    29386	,//	-9870		328
    29376	,//	-9900		329
    29366	,//	-9930		330
    29356	,//	-9960		331
    29346	,//	-9990		332
    29335	,//	-10020		333
    29325	,//	-10050		334
    29315	,//	-10080		335
    29305	,//	-10110		336
    29294	,//	-10140		337
    29284	,//	-10170		338
    29273	,//	-10200		339
    29263	,//	-10230		340
    29252	,//	-10260		341
    29242	,//	-10290		342
    29231	,//	-10320		343
    29221	,//	-10350		344
    29210	,//	-10380		345
    29199	,//	-10410		346
    29189	,//	-10440		347
    29178	,//	-10470		348
    29167	,//	-10500		349
    29156	,//	-10530		350
    29145	,//	-10560		351
    29135	,//	-10590		352
    29124	,//	-10620		353
    29113	,//	-10650		354
    29102	,//	-10680		355
    29091	,//	-10710		356
    29080	,//	-10740		357
    29069	,//	-10770		358
    29057	,//	-10800		359
    29046	,//	-10830		360
    29035	,//	-10860		361
    29024	,//	-10890		362
    29012	,//	-10920		363
    29001	,//	-10950		364
    28990	,//	-10980		365
    28978	,//	-11010		366
    28967	,//	-11040		367
    28956	,//	-11070		368
    28944	,//	-11100		369
    28933	,//	-11130		370
    28921	,//	-11160		371
    28909	,//	-11190		372
    28898	,//	-11220		373
    28886	,//	-11250		374
    28874	,//	-11280		375
    28863	,//	-11310		376
    28851	,//	-11340		377
    28839	,//	-11370		378
    28827	,//	-11400		379
    28815	,//	-11430		380
    28803	,//	-11460		381
    28792	,//	-11490		382
    28780	,//	-11520		383
    28767	,//	-11550		384
    28755	,//	-11580		385
    28743	,//	-11610		386
    28731	,//	-11640		387
    28719	,//	-11670		388
    28707	,//	-11700		389
    28695	,//	-11730		390
    28682	,//	-11760		391
    28670	,//	-11790		392
    28658	,//	-11820		393
    28645	,//	-11850		394
    28633	,//	-11880		395
    28620	,//	-11910		396
    28608	,//	-11940		397
    28595	,//	-11970		398
    28583	,//	-12000		399
    28570	,//	-12030		400
    28557	,//	-12060		401
    28545	,//	-12090		402
    28532	,//	-12120		403
    28519	,//	-12150		404
    28506	,//	-12180		405
    28494	,//	-12210		406
    28481	,//	-12240		407
    28468	,//	-12270		408
    28455	,//	-12300		409
    28442	,//	-12330		410
    28429	,//	-12360		411
    28416	,//	-12390		412
    28403	,//	-12420		413
    28390	,//	-12450		414
    28376	,//	-12480		415
    28363	,//	-12510		416
    28350	,//	-12540		417
    28337	,//	-12570		418
    28323	,//	-12600		419
    28310	,//	-12630		420
    28297	,//	-12660		421
    28283	,//	-12690		422
    28270	,//	-12720		423
    28256	,//	-12750		424
    28243	,//	-12780		425
    28229	,//	-12810		426
    28215	,//	-12840		427
    28202	,//	-12870		428
    28188	,//	-12900		429
    28174	,//	-12930		430
    28160	,//	-12960		431
    28147	,//	-12990		432
    28133	,//	-13020		433
    28119	,//	-13050		434
    28105	,//	-13080		435
    28091	,//	-13110		436
    28077	,//	-13140		437
    28063	,//	-13170		438
    28049	,//	-13200		439
    28035	,//	-13230		440
    28020	,//	-13260		441
    28006	,//	-13290		442
    27992	,//	-13320		443
    27978	,//	-13350		444
    27963	,//	-13380		445
    27949	,//	-13410		446
    27935	,//	-13440		447
    27920	,//	-13470		448
    27906	,//	-13500		449
    27891	,//	-13530		450
    27876	,//	-13560		451
    27862	,//	-13590		452
    27847	,//	-13620		453
    27833	,//	-13650		454
    27818	,//	-13680		455
    27803	,//	-13710		456
    27788	,//	-13740		457
    27773	,//	-13770		458
    27758	,//	-13800		459
    27744	,//	-13830		460
    27729	,//	-13860		461
    27714	,//	-13890		462
    27698	,//	-13920		463
    27683	,//	-13950		464
    27668	,//	-13980		465
    27653	,//	-14010		466
    27638	,//	-14040		467
    27623	,//	-14070		468
    27607	,//	-14100		469
    27592	,//	-14130		470
    27577	,//	-14160		471
    27561	,//	-14190		472
    27546	,//	-14220		473
    27530	,//	-14250		474
    27515	,//	-14280		475
    27499	,//	-14310		476
    27483	,//	-14340		477
    27468	,//	-14370		478
    27452	,//	-14400		479
    27436	,//	-14430		480
    27420	,//	-14460		481
    27405	,//	-14490		482
    27389	,//	-14520		483
    27373	,//	-14550		484
    27357	,//	-14580		485
    27341	,//	-14610		486
    27325	,//	-14640		487
    27309	,//	-14670		488
    27293	,//	-14700		489
    27276	,//	-14730		490
    27260	,//	-14760		491
    27244	,//	-14790		492
    27228	,//	-14820		493
    27211	,//	-14850		494
    27195	,//	-14880		495
    27178	,//	-14910		496
    27162	,//	-14940		497
    27145	,//	-14970		498
    27129	,//	-15000		499
    27112	,//	-15030		500
    27096	,//	-15060		501
    27079	,//	-15090		502
    27062	,//	-15120		503
    27045	,//	-15150		504
    27029	,//	-15180		505
    27012	,//	-15210		506
    26995	,//	-15240		507
    26978	,//	-15270		508
    26961	,//	-15300		509
    26944	,//	-15330		510
    26927	,//	-15360		511
    26909	,//	-15390		512
    26892	,//	-15420		513
    26875	,//	-15450		514
    26858	,//	-15480		515
    26841	,//	-15510		516
    26823	,//	-15540		517
    26806	,//	-15570		518
    26788	,//	-15600		519
    26771	,//	-15630		520
    26753	,//	-15660		521
    26736	,//	-15690		522
    26718	,//	-15720		523
    26700	,//	-15750		524
    26683	,//	-15780		525
    26665	,//	-15810		526
    26647	,//	-15840		527
    26629	,//	-15870		528
    26611	,//	-15900		529
    26593	,//	-15930		530
    26575	,//	-15960		531
    26557	,//	-15990		532
    26539	,//	-16020		533
    26521	,//	-16050		534
    26503	,//	-16080		535
    26485	,//	-16110		536
    26466	,//	-16140		537
    26448	,//	-16170		538
    26430	,//	-16200		539
    26411	,//	-16230		540
    26393	,//	-16260		541
    26374	,//	-16290		542
    26356	,//	-16320		543
    26337	,//	-16350		544
    26319	,//	-16380		545
    26300	,//	-16410		546
    26281	,//	-16440		547
    26262	,//	-16470		548
    26244	,//	-16500		549
    26225	,//	-16530		550
    26206	,//	-16560		551
    26187	,//	-16590		552
    26168	,//	-16620		553
    26149	,//	-16650		554
    26130	,//	-16680		555
    26110	,//	-16710		556
    26091	,//	-16740		557
    26072	,//	-16770		558
    26053	,//	-16800		559
    26033	,//	-16830		560
    26014	,//	-16860		561
    25994	,//	-16890		562
    25975	,//	-16920		563
    25955	,//	-16950		564
    25936	,//	-16980		565
    25916	,//	-17010		566
    25896	,//	-17040		567
    25876	,//	-17070		568
    25857	,//	-17100		569
    25837	,//	-17130		570
    25817	,//	-17160		571
    25797	,//	-17190		572
    25777	,//	-17220		573
    25757	,//	-17250		574
    25737	,//	-17280		575
    25716	,//	-17310		576
    25696	,//	-17340		577
    25676	,//	-17370		578
    25656	,//	-17400		579
    25635	,//	-17430		580
    25615	,//	-17460		581
    25594	,//	-17490		582
    25574	,//	-17520		583
    25553	,//	-17550		584
    25533	,//	-17580		585
    25512	,//	-17610		586
    25491	,//	-17640		587
    25470	,//	-17670		588
    25450	,//	-17700		589
    25429	,//	-17730		590
    25408	,//	-17760		591
    25387	,//	-17790		592
    25366	,//	-17820		593
    25345	,//	-17850		594
    25324	,//	-17880		595
    25302	,//	-17910		596
    25281	,//	-17940		597
    25260	,//	-17970		598
    25238	,//	-18000		599
    25217	,//	-18030		600
    25195	,//	-18060		601
    25174	,//	-18090		602
    25152	,//	-18120		603
    25131	,//	-18150		604
    25109	,//	-18180		605
    25087	,//	-18210		606
    25065	,//	-18240		607
    25044	,//	-18270		608
    25022	,//	-18300		609
    25000	,//	-18330		610
    24978	,//	-18360		611
    24956	,//	-18390		612
    24933	,//	-18420		613
    24911	,//	-18450		614
    24889	,//	-18480		615
    24867	,//	-18510		616
    24844	,//	-18540		617
    24822	,//	-18570		618
    24800	,//	-18600		619
    24777	,//	-18630		620
    24754	,//	-18660		621
    24732	,//	-18690		622
    24709	,//	-18720		623
    24686	,//	-18750		624
    24663	,//	-18780		625
    24641	,//	-18810		626
    24618	,//	-18840		627
    24595	,//	-18870		628
    24572	,//	-18900		629
    24549	,//	-18930		630
    24525	,//	-18960		631
    24502	,//	-18990		632
    24479	,//	-19020		633
    24456	,//	-19050		634
    24432	,//	-19080		635
    24409	,//	-19110		636
    24385	,//	-19140		637
    24362	,//	-19170		638
    24338	,//	-19200		639
    24314	,//	-19230		640
    24290	,//	-19260		641
    24267	,//	-19290		642
    24243	,//	-19320		643
    24219	,//	-19350		644
    24195	,//	-19380		645
    24171	,//	-19410		646
    24147	,//	-19440		647
    24122	,//	-19470		648
    24098	,//	-19500		649
    24074	,//	-19530		650
    24050	,//	-19560		651
    24025	,//	-19590		652
    24001	,//	-19620		653
    23976	,//	-19650		654
    23951	,//	-19680		655
    23927	,//	-19710		656
    23902	,//	-19740		657
    23877	,//	-19770		658
    23852	,//	-19800		659
    23827	,//	-19830		660
    23802	,//	-19860		661
    23777	,//	-19890		662
    23752	,//	-19920		663
    23727	,//	-19950		664
    23702	,//	-19980		665
    23676	,//	-20010		666
    23651	,//	-20040		667
    23626	,//	-20070		668
    23600	,//	-20100		669
    23575	,//	-20130		670
    23549	,//	-20160		671
    23523	,//	-20190		672
    23497	,//	-20220		673
    23472	,//	-20250		674
    23446	,//	-20280		675
    23420	,//	-20310		676
    23394	,//	-20340		677
    23367	,//	-20370		678
    23341	,//	-20400		679
    23315	,//	-20430		680
    23289	,//	-20460		681
    23262	,//	-20490		682
    23236	,//	-20520		683
    23209	,//	-20550		684
    23183	,//	-20580		685
    23156	,//	-20610		686
    23129	,//	-20640		687
    23103	,//	-20670		688
    23076	,//	-20700		689
    23049	,//	-20730		690
    23022	,//	-20760		691
    22995	,//	-20790		692
    22967	,//	-20820		693
    22940	,//	-20850		694
    22913	,//	-20880		695
    22886	,//	-20910		696
    22858	,//	-20940		697
    22831	,//	-20970		698
    22803	,//	-21000		699
    22775	,//	-21030		700
    22748	,//	-21060		701
    22720	,//	-21090		702
    22692	,//	-21120		703
    22664	,//	-21150		704
    22636	,//	-21180		705
    22608	,//	-21210		706
    22580	,//	-21240		707
    22551	,//	-21270		708
    22523	,//	-21300		709
    22495	,//	-21330		710
    22466	,//	-21360		711
    22438	,//	-21390		712
    22409	,//	-21420		713
    22380	,//	-21450		714
    22351	,//	-21480		715
    22323	,//	-21510		716
    22294	,//	-21540		717
    22265	,//	-21570		718
    22236	,//	-21600		719
    22206	,//	-21630		720
    22177	,//	-21660		721
    22148	,//	-21690		722
    22118	,//	-21720		723
    22089	,//	-21750		724
    22059	,//	-21780		725
    22030	,//	-21810		726
    22000	,//	-21840		727
    21970	,//	-21870		728
    21940	,//	-21900		729
    21910	,//	-21930		730
    21880	,//	-21960		731
    21850	,//	-21990		732
    21820	,//	-22020		733
    21789	,//	-22050		734
    21759	,//	-22080		735
    21728	,//	-22110		736
    21698	,//	-22140		737
    21667	,//	-22170		738
    21637	,//	-22200		739
    21606	,//	-22230		740
    21575	,//	-22260		741
    21544	,//	-22290		742
    21513	,//	-22320		743
    21482	,//	-22350		744
    21450	,//	-22380		745
    21419	,//	-22410		746
    21387	,//	-22440		747
    21356	,//	-22470		748
    21324	,//	-22500		749
    21293	,//	-22530		750
    21261	,//	-22560		751
    21229	,//	-22590		752
    21197	,//	-22620		753
    21165	,//	-22650		754
    21133	,//	-22680		755
    21101	,//	-22710		756
    21068	,//	-22740		757
    21036	,//	-22770		758
    21003	,//	-22800		759
    20971	,//	-22830		760
    20938	,//	-22860		761
    20905	,//	-22890		762
    20872	,//	-22920		763
    20839	,//	-22950		764
    20806	,//	-22980		765
    20773	,//	-23010		766
    20740	,//	-23040		767
    20706	,//	-23070		768
    20673	,//	-23100		769
    20639	,//	-23130		770
    20606	,//	-23160		771
    20572	,//	-23190		772
    20538	,//	-23220		773
    20504	,//	-23250		774
    20470	,//	-23280		775
    20436	,//	-23310		776
    20402	,//	-23340		777
    20367	,//	-23370		778
    20333	,//	-23400		779
    20298	,//	-23430		780
    20263	,//	-23460		781
    20229	,//	-23490		782
    20194	,//	-23520		783
    20159	,//	-23550		784
    20124	,//	-23580		785
    20088	,//	-23610		786
    20053	,//	-23640		787
    20018	,//	-23670		788
    19982	,//	-23700		789
    19947	,//	-23730		790
    19911	,//	-23760		791
    19875	,//	-23790		792
    19839	,//	-23820		793
    19803	,//	-23850		794
    19767	,//	-23880		795
    19730	,//	-23910		796
    19694	,//	-23940		797
    19658	,//	-23970		798
    19621	,//	-24000		799
    19584	,//	-24030		800
    19547	,//	-24060		801
    19510	,//	-24090		802
    19473	,//	-24120		803
    19436	,//	-24150		804
    19399	,//	-24180		805
    19361	,//	-24210		806
    19324	,//	-24240		807
    19286	,//	-24270		808
    19248	,//	-24300		809
    19210	,//	-24330		810
    19172	,//	-24360		811
    19134	,//	-24390		812
    19096	,//	-24420		813
    19057	,//	-24450		814
    19019	,//	-24480		815
    18980	,//	-24510		816
    18941	,//	-24540		817
    18902	,//	-24570		818
    18863	,//	-24600		819
    18824	,//	-24630		820
    18785	,//	-24660		821
    18745	,//	-24690		822
    18706	,//	-24720		823
    18666	,//	-24750		824
    18626	,//	-24780		825
    18586	,//	-24810		826
    18546	,//	-24840		827
    18506	,//	-24870		828
    18465	,//	-24900		829
    18425	,//	-24930		830
    18384	,//	-24960		831
    18343	,//	-24990		832
    18302	,//	-25020		833
    18261	,//	-25050		834
    18220	,//	-25080		835
    18179	,//	-25110		836
    18137	,//	-25140		837
    18096	,//	-25170		838
    18054	,//	-25200		839
    18012	,//	-25230		840
    17970	,//	-25260		841
    17928	,//	-25290		842
    17885	,//	-25320		843
    17843	,//	-25350		844
    17800	,//	-25380		845
    17757	,//	-25410		846
    17714	,//	-25440		847
    17671	,//	-25470		848
    17628	,//	-25500		849
    17584	,//	-25530		850
    17540	,//	-25560		851
    17497	,//	-25590		852
    17453	,//	-25620		853
    17409	,//	-25650		854
    17364	,//	-25680		855
    17320	,//	-25710		856
    17275	,//	-25740		857
    17230	,//	-25770		858
    17186	,//	-25800		859
    17140	,//	-25830		860
    17095	,//	-25860		861	same
    17050	,//	-25890		861	same
    17004	,//	-25920		862
    16958	,//	-25950		863
    16912	,//	-25980		864
    16866	,//	-26010		865
    16820	,//	-26040		866
    16773	,//	-26070		867
    16726	,//	-26100		868
    16680	,//	-26130		869
    16632	,//	-26160		870
    16585	,//	-26190		871
    16538	,//	-26220		872
    16490	,//	-26250		873
    16442	,//	-26280		874
    16394	,//	-26310		875
    16346	,//	-26340		876
    16297	,//	-26370		877
    16249	,//	-26400		878
    16200	,//	-26430		879
    16151	,//	-26460		880
    16102	,//	-26490		881
    16052	,//	-26520		882
    16003	,//	-26550		883
    15953	,//	-26580		884
    15903	,//	-26610		885
    15852	,//	-26640		886
    15802	,//	-26670		887
    15751	,//	-26700		888
    15700	,//	-26730		889
    15649	,//	-26760		890
    15597	,//	-26790		891
    15546	,//	-26820		892
    15494	,//	-26850		893
    15442	,//	-26880		894
    15389	,//	-26910		895
    15337	,//	-26940		896
    15284	,//	-26970		897
    15231	,//	-27000		898
    15178	,//	-27030		899
    15124	,//	-27060		900
    15070	,//	-27090		901
    15016	,//	-27120		902
    14962	,//	-27150		903
    14907	,//	-27180		904
    14853	,//	-27210		905
    14798	,//	-27240		906
    14742	,//	-27270		907
    14687	,//	-27300		908
    14631	,//	-27330		909
    14574	,//	-27360		910
    14518	,//	-27390		911
    14461	,//	-27420		912
    14404	,//	-27450		913
    14347	,//	-27480		914
    14289	,//	-27510		915
    14231	,//	-27540		916
    14173	,//	-27570		917
    14115	,//	-27600		918
    14056	,//	-27630		919
    13997	,//	-27660		920
    13937	,//	-27690		921
    13878	,//	-27720		922
    13818	,//	-27750		923
    13757	,//	-27780		924
    13696	,//	-27810		925
    13635	,//	-27840		926
    13574	,//	-27870		927
    13512	,//	-27900		928
    13450	,//	-27930		929
    13387	,//	-27960		930
    13325	,//	-27990		931
    13261	,//	-28020		932
    13198	,//	-28050		933
    13134	,//	-28080		934
    13070	,//	-28110		935
    13005	,//	-28140		936
    12940	,//	-28170		937
    12874	,//	-28200		938
    12808	,//	-28230		939
    12742	,//	-28260		940
    12675	,//	-28290		941
    12608	,//	-28320		942
    12541	,//	-28350		943
    12472	,//	-28380		944
    12404	,//	-28410		945
    12335	,//	-28440		946
    12266	,//	-28470		947
    12196	,//	-28500		948
    12125	,//	-28530		949
    12055	,//	-28560		950
    11983	,//	-28590		951
    11911	,//	-28620		952
    11839	,//	-28650		953
    11766	,//	-28680		954
    11693	,//	-28710		955
    11619	,//	-28740		956
    11545	,//	-28770		957
    11469	,//	-28800		958
    11394	,//	-28830		959
    11318	,//	-28860		960
    11241	,//	-28890		961
    11163	,//	-28920		962
    11085	,//	-28950		963
    11007	,//	-28980		964
    10927	,//	-29010		965
    10847	,//	-29040		966
    10767	,//	-29070		967
    10685	,//	-29100		968
    10603	,//	-29130		969
    10521	,//	-29160		970
    10437	,//	-29190		971
    10353	,//	-29220		972
    10268	,//	-29250		973
    10182	,//	-29280		974
    10095	,//	-29310		975
    10008	,//	-29340		976
    9919	,//	-29370		977
    9830	,//	-29400		978
    9740	,//	-29430		979
    9649	,//	-29460		980
    9557	,//	-29490		981
    9464	,//	-29520		982
    9370	,//	-29550		983
    9274	,//	-29580		984
    9178	,//	-29610		985
    9081	,//	-29640		986
    8982	,//	-29670		987
    8883	,//	-29700		988
    8782	,//	-29730		989
    8680	,//	-29760		990
    8576	,//	-29790		991
    8471	,//	-29820		992
    8365	,//	-29850		993
    8257	,//	-29880		994
    8148	,//	-29910		995
    8037	,//	-29940		996
    7924	,//	-29970		997
    7810	,//	-30000		998
    7694	,//	-30030		999
    7576	,//	-30060		1000
    7455	,//	-30090		1001
    7333	,//	-30120		1002
    7209	,//	-30150		1003
    7082	,//	-30180		1004
    6953	,//	-30210		1005
    6822	,//	-30240		1006
    6687	,//	-30270		1007
    6550	,//	-30300		1008
    6410	,//	-30330		1009
    6266	,//	-30360		1010
    6119	,//	-30390		1011
    5968	,//	-30420		1012
    5813	,//	-30450		1013
    5654	,//	-30480		1014
    5489	,//	-30510		1015
    5320	,//	-30540		1016
    5145	,//	-30570		1017
    4963	,//	-30600		1018
    4775	,//	-30630		1019
    4578	,//	-30660		1020
    4373	,//	-30690		1021
    4157	,//	-30720		1022
    3929	,//	-30750		1023
    3686	,//	-30780		1024
    3426	,//	-30810		1025
    3145	,//	-30840		1026
    2836	,//	-30870		1027
    2487	,//	-30900		1028
    2082	,//	-30930		1029
    1574	,//	-30960		1030
    787	,//	-30990		1031
};

const signed int SinTab_1024[1025] = {
    0	,	//	0
    50	,	//	1
    100	,	//	2
    150	,	//	3
    201	,	//	4
    251	,	//	5
    301	,	//	6
    351	,	//	7
    402	,	//	8
    452	,	//	9
    502	,	//	10
    552	,	//	11
    603	,	//	12
    653	,	//	13
    703	,	//	14
    753	,	//	15
    804	,	//	16
    854	,	//	17
    904	,	//	18
    954	,	//	19
    1005	,	//	20
    1055	,	//	21
    1105	,	//	22
    1155	,	//	23
    1206	,	//	24
    1256	,	//	25
    1306	,	//	26
    1356	,	//	27
    1407	,	//	28
    1457	,	//	29
    1507	,	//	30
    1557	,	//	31
    1607	,	//	32
    1658	,	//	33
    1708	,	//	34
    1758	,	//	35
    1808	,	//	36
    1858	,	//	37
    1909	,	//	38
    1959	,	//	39
    2009	,	//	40
    2059	,	//	41
    2109	,	//	42
    2159	,	//	43
    2210	,	//	44
    2260	,	//	45
    2310	,	//	46
    2360	,	//	47
    2410	,	//	48
    2460	,	//	49
    2510	,	//	50
    2560	,	//	51
    2611	,	//	52
    2661	,	//	53
    2711	,	//	54
    2761	,	//	55
    2811	,	//	56
    2861	,	//	57
    2911	,	//	58
    2961	,	//	59
    3011	,	//	60
    3061	,	//	61
    3111	,	//	62
    3161	,	//	63
    3211	,	//	64
    3261	,	//	65
    3311	,	//	66
    3361	,	//	67
    3411	,	//	68
    3461	,	//	69
    3511	,	//	70
    3561	,	//	71
    3611	,	//	72
    3661	,	//	73
    3711	,	//	74
    3761	,	//	75
    3811	,	//	76
    3861	,	//	77
    3911	,	//	78
    3961	,	//	79
    4011	,	//	80
    4061	,	//	81
    4110	,	//	82
    4160	,	//	83
    4210	,	//	84
    4260	,	//	85
    4310	,	//	86
    4360	,	//	87
    4409	,	//	88
    4459	,	//	89
    4509	,	//	90
    4559	,	//	91
    4609	,	//	92
    4658	,	//	93
    4708	,	//	94
    4758	,	//	95
    4808	,	//	96
    4857	,	//	97
    4907	,	//	98
    4957	,	//	99
    5006	,	//	100
    5056	,	//	101
    5106	,	//	102
    5155	,	//	103
    5205	,	//	104
    5255	,	//	105
    5304	,	//	106
    5354	,	//	107
    5403	,	//	108
    5453	,	//	109
    5503	,	//	110
    5552	,	//	111
    5602	,	//	112
    5651	,	//	113
    5701	,	//	114
    5750	,	//	115
    5800	,	//	116
    5849	,	//	117
    5898	,	//	118
    5948	,	//	119
    5997	,	//	120
    6047	,	//	121
    6096	,	//	122
    6146	,	//	123
    6195	,	//	124
    6244	,	//	125
    6294	,	//	126
    6343	,	//	127
    6392	,	//	128
    6442	,	//	129
    6491	,	//	130
    6540	,	//	131
    6589	,	//	132
    6639	,	//	133
    6688	,	//	134
    6737	,	//	135
    6786	,	//	136
    6835	,	//	137
    6884	,	//	138
    6934	,	//	139
    6983	,	//	140
    7032	,	//	141
    7081	,	//	142
    7130	,	//	143
    7179	,	//	144
    7228	,	//	145
    7277	,	//	146
    7326	,	//	147
    7375	,	//	148
    7424	,	//	149
    7473	,	//	150
    7522	,	//	151
    7571	,	//	152
    7620	,	//	153
    7669	,	//	154
    7717	,	//	155
    7766	,	//	156
    7815	,	//	157
    7864	,	//	158
    7913	,	//	159
    7961	,	//	160
    8010	,	//	161
    8059	,	//	162
    8108	,	//	163
    8156	,	//	164
    8205	,	//	165
    8254	,	//	166
    8302	,	//	167
    8351	,	//	168
    8400	,	//	169
    8448	,	//	170
    8497	,	//	171
    8545	,	//	172
    8594	,	//	173
    8642	,	//	174
    8691	,	//	175
    8739	,	//	176
    8788	,	//	177
    8836	,	//	178
    8884	,	//	179
    8933	,	//	180
    8981	,	//	181
    9029	,	//	182
    9078	,	//	183
    9126	,	//	184
    9174	,	//	185
    9223	,	//	186
    9271	,	//	187
    9319	,	//	188
    9367	,	//	189
    9415	,	//	190
    9463	,	//	191
    9512	,	//	192
    9560	,	//	193
    9608	,	//	194
    9656	,	//	195
    9704	,	//	196
    9752	,	//	197
    9800	,	//	198
    9848	,	//	199
    9896	,	//	200
    9944	,	//	201
    9991	,	//	202
    10039	,	//	203
    10087	,	//	204
    10135	,	//	205
    10183	,	//	206
    10230	,	//	207
    10278	,	//	208
    10326	,	//	209
    10374	,	//	210
    10421	,	//	211
    10469	,	//	212
    10517	,	//	213
    10564	,	//	214
    10612	,	//	215
    10659	,	//	216
    10707	,	//	217
    10754	,	//	218
    10802	,	//	219
    10849	,	//	220
    10897	,	//	221
    10944	,	//	222
    10991	,	//	223
    11039	,	//	224
    11086	,	//	225
    11133	,	//	226
    11181	,	//	227
    11228	,	//	228
    11275	,	//	229
    11322	,	//	230
    11369	,	//	231
    11416	,	//	232
    11464	,	//	233
    11511	,	//	234
    11558	,	//	235
    11605	,	//	236
    11652	,	//	237
    11699	,	//	238
    11746	,	//	239
    11793	,	//	240
    11839	,	//	241
    11886	,	//	242
    11933	,	//	243
    11980	,	//	244
    12027	,	//	245
    12073	,	//	246
    12120	,	//	247
    12167	,	//	248
    12213	,	//	249
    12260	,	//	250
    12307	,	//	251
    12353	,	//	252
    12400	,	//	253
    12446	,	//	254
    12493	,	//	255
    12539	,	//	256
    12586	,	//	257
    12632	,	//	258
    12678	,	//	259
    12725	,	//	260
    12771	,	//	261
    12817	,	//	262
    12864	,	//	263
    12910	,	//	264
    12956	,	//	265
    13002	,	//	266
    13048	,	//	267
    13094	,	//	268
    13140	,	//	269
    13186	,	//	270
    13232	,	//	271
    13278	,	//	272
    13324	,	//	273
    13370	,	//	274
    13416	,	//	275
    13462	,	//	276
    13508	,	//	277
    13554	,	//	278
    13599	,	//	279
    13645	,	//	280
    13691	,	//	281
    13736	,	//	282
    13782	,	//	283
    13828	,	//	284
    13873	,	//	285
    13919	,	//	286
    13964	,	//	287
    14010	,	//	288
    14055	,	//	289
    14100	,	//	290
    14146	,	//	291
    14191	,	//	292
    14236	,	//	293
    14282	,	//	294
    14327	,	//	295
    14372	,	//	296
    14417	,	//	297
    14462	,	//	298
    14507	,	//	299
    14552	,	//	300
    14598	,	//	301
    14642	,	//	302
    14687	,	//	303
    14732	,	//	304
    14777	,	//	305
    14822	,	//	306
    14867	,	//	307
    14912	,	//	308
    14956	,	//	309
    15001	,	//	310
    15046	,	//	311
    15090	,	//	312
    15135	,	//	313
    15180	,	//	314
    15224	,	//	315
    15269	,	//	316
    15313	,	//	317
    15357	,	//	318
    15402	,	//	319
    15446	,	//	320
    15491	,	//	321
    15535	,	//	322
    15579	,	//	323
    15623	,	//	324
    15667	,	//	325
    15712	,	//	326
    15756	,	//	327
    15800	,	//	328
    15844	,	//	329
    15888	,	//	330
    15932	,	//	331
    15976	,	//	332
    16019	,	//	333
    16063	,	//	334
    16107	,	//	335
    16151	,	//	336
    16195	,	//	337
    16238	,	//	338
    16282	,	//	339
    16325	,	//	340
    16369	,	//	341
    16413	,	//	342
    16456	,	//	343
    16499	,	//	344
    16543	,	//	345
    16586	,	//	346
    16630	,	//	347
    16673	,	//	348
    16716	,	//	349
    16759	,	//	350
    16802	,	//	351
    16846	,	//	352
    16889	,	//	353
    16932	,	//	354
    16975	,	//	355
    17018	,	//	356
    17061	,	//	357
    17104	,	//	358
    17146	,	//	359
    17189	,	//	360
    17232	,	//	361
    17275	,	//	362
    17317	,	//	363
    17360	,	//	364
    17403	,	//	365
    17445	,	//	366
    17488	,	//	367
    17530	,	//	368
    17573	,	//	369
    17615	,	//	370
    17658	,	//	371
    17700	,	//	372
    17742	,	//	373
    17784	,	//	374
    17827	,	//	375
    17869	,	//	376
    17911	,	//	377
    17953	,	//	378
    17995	,	//	379
    18037	,	//	380
    18079	,	//	381
    18121	,	//	382
    18163	,	//	383
    18204	,	//	384
    18246	,	//	385
    18288	,	//	386
    18330	,	//	387
    18371	,	//	388
    18413	,	//	389
    18454	,	//	390
    18496	,	//	391
    18537	,	//	392
    18579	,	//	393
    18620	,	//	394
    18662	,	//	395
    18703	,	//	396
    18744	,	//	397
    18785	,	//	398
    18826	,	//	399
    18868	,	//	400
    18909	,	//	401
    18950	,	//	402
    18991	,	//	403
    19032	,	//	404
    19073	,	//	405
    19113	,	//	406
    19154	,	//	407
    19195	,	//	408
    19236	,	//	409
    19276	,	//	410
    19317	,	//	411
    19358	,	//	412
    19398	,	//	413
    19439	,	//	414
    19479	,	//	415
    19519	,	//	416
    19560	,	//	417
    19600	,	//	418
    19640	,	//	419
    19681	,	//	420
    19721	,	//	421
    19761	,	//	422
    19801	,	//	423
    19841	,	//	424
    19881	,	//	425
    19921	,	//	426
    19961	,	//	427
    20001	,	//	428
    20040	,	//	429
    20080	,	//	430
    20120	,	//	431
    20159	,	//	432
    20199	,	//	433
    20239	,	//	434
    20278	,	//	435
    20318	,	//	436
    20357	,	//	437
    20396	,	//	438
    20436	,	//	439
    20475	,	//	440
    20514	,	//	441
    20553	,	//	442
    20592	,	//	443
    20631	,	//	444
    20671	,	//	445
    20709	,	//	446
    20748	,	//	447
    20787	,	//	448
    20826	,	//	449
    20865	,	//	450
    20904	,	//	451
    20942	,	//	452
    20981	,	//	453
    21020	,	//	454
    21058	,	//	455
    21097	,	//	456
    21135	,	//	457
    21173	,	//	458
    21212	,	//	459
    21250	,	//	460
    21288	,	//	461
    21326	,	//	462
    21365	,	//	463
    21403	,	//	464
    21441	,	//	465
    21479	,	//	466
    21517	,	//	467
    21555	,	//	468
    21592	,	//	469
    21630	,	//	470
    21668	,	//	471
    21706	,	//	472
    21743	,	//	473
    21781	,	//	474
    21818	,	//	475
    21856	,	//	476
    21893	,	//	477
    21931	,	//	478
    21968	,	//	479
    22005	,	//	480
    22042	,	//	481
    22080	,	//	482
    22117	,	//	483
    22154	,	//	484
    22191	,	//	485
    22228	,	//	486
    22265	,	//	487
    22301	,	//	488
    22338	,	//	489
    22375	,	//	490
    22412	,	//	491
    22448	,	//	492
    22485	,	//	493
    22521	,	//	494
    22558	,	//	495
    22594	,	//	496
    22631	,	//	497
    22667	,	//	498
    22703	,	//	499
    22740	,	//	500
    22776	,	//	501
    22812	,	//	502
    22848	,	//	503
    22884	,	//	504
    22920	,	//	505
    22956	,	//	506
    22992	,	//	507
    23027	,	//	508
    23063	,	//	509
    23099	,	//	510
    23134	,	//	511
    23170	,	//	512
    23205	,	//	513
    23241	,	//	514
    23276	,	//	515
    23312	,	//	516
    23347	,	//	517
    23382	,	//	518
    23417	,	//	519
    23453	,	//	520
    23488	,	//	521
    23523	,	//	522
    23558	,	//	523
    23593	,	//	524
    23627	,	//	525
    23662	,	//	526
    23697	,	//	527
    23732	,	//	528
    23766	,	//	529
    23801	,	//	530
    23835	,	//	531
    23870	,	//	532
    23904	,	//	533
    23939	,	//	534
    23973	,	//	535
    24007	,	//	536
    24041	,	//	537
    24075	,	//	538
    24109	,	//	539
    24144	,	//	540
    24177	,	//	541
    24211	,	//	542
    24245	,	//	543
    24279	,	//	544
    24313	,	//	545
    24346	,	//	546
    24380	,	//	547
    24414	,	//	548
    24447	,	//	549
    24480	,	//	550
    24514	,	//	551
    24547	,	//	552
    24580	,	//	553
    24614	,	//	554
    24647	,	//	555
    24680	,	//	556
    24713	,	//	557
    24746	,	//	558
    24779	,	//	559
    24812	,	//	560
    24845	,	//	561
    24877	,	//	562
    24910	,	//	563
    24943	,	//	564
    24975	,	//	565
    25008	,	//	566
    25040	,	//	567
    25073	,	//	568
    25105	,	//	569
    25137	,	//	570
    25169	,	//	571
    25201	,	//	572
    25234	,	//	573
    25266	,	//	574
    25298	,	//	575
    25330	,	//	576
    25361	,	//	577
    25393	,	//	578
    25425	,	//	579
    25457	,	//	580
    25488	,	//	581
    25520	,	//	582
    25551	,	//	583
    25583	,	//	584
    25614	,	//	585
    25645	,	//	586
    25677	,	//	587
    25708	,	//	588
    25739	,	//	589
    25770	,	//	590
    25801	,	//	591
    25832	,	//	592
    25863	,	//	593
    25894	,	//	594
    25925	,	//	595
    25955	,	//	596
    25986	,	//	597
    26016	,	//	598
    26047	,	//	599
    26077	,	//	600
    26108	,	//	601
    26138	,	//	602
    26169	,	//	603
    26199	,	//	604
    26229	,	//	605
    26259	,	//	606
    26289	,	//	607
    26319	,	//	608
    26349	,	//	609
    26379	,	//	610
    26409	,	//	611
    26438	,	//	612
    26468	,	//	613
    26498	,	//	614
    26527	,	//	615
    26557	,	//	616
    26586	,	//	617
    26615	,	//	618
    26645	,	//	619
    26674	,	//	620
    26703	,	//	621
    26732	,	//	622
    26761	,	//	623
    26790	,	//	624
    26819	,	//	625
    26848	,	//	626
    26877	,	//	627
    26905	,	//	628
    26934	,	//	629
    26963	,	//	630
    26991	,	//	631
    27020	,	//	632
    27048	,	//	633
    27076	,	//	634
    27105	,	//	635
    27133	,	//	636
    27161	,	//	637
    27189	,	//	638
    27217	,	//	639
    27245	,	//	640
    27273	,	//	641
    27301	,	//	642
    27329	,	//	643
    27356	,	//	644
    27384	,	//	645
    27411	,	//	646
    27439	,	//	647
    27466	,	//	648
    27494	,	//	649
    27521	,	//	650
    27548	,	//	651
    27576	,	//	652
    27603	,	//	653
    27630	,	//	654
    27657	,	//	655
    27684	,	//	656
    27711	,	//	657
    27737	,	//	658
    27764	,	//	659
    27791	,	//	660
    27817	,	//	661
    27844	,	//	662
    27870	,	//	663
    27897	,	//	664
    27923	,	//	665
    27949	,	//	666
    27976	,	//	667
    28002	,	//	668
    28028	,	//	669
    28054	,	//	670
    28080	,	//	671
    28106	,	//	672
    28131	,	//	673
    28157	,	//	674
    28183	,	//	675
    28208	,	//	676
    28234	,	//	677
    28259	,	//	678
    28285	,	//	679
    28310	,	//	680
    28335	,	//	681
    28361	,	//	682
    28386	,	//	683
    28411	,	//	684
    28436	,	//	685
    28461	,	//	686
    28486	,	//	687
    28511	,	//	688
    28535	,	//	689
    28560	,	//	690
    28585	,	//	691
    28609	,	//	692
    28634	,	//	693
    28658	,	//	694
    28682	,	//	695
    28707	,	//	696
    28731	,	//	697
    28755	,	//	698
    28779	,	//	699
    28803	,	//	700
    28827	,	//	701
    28851	,	//	702
    28875	,	//	703
    28898	,	//	704
    28922	,	//	705
    28946	,	//	706
    28969	,	//	707
    28993	,	//	708
    29016	,	//	709
    29039	,	//	710
    29062	,	//	711
    29086	,	//	712
    29109	,	//	713
    29132	,	//	714
    29155	,	//	715
    29178	,	//	716
    29201	,	//	717
    29223	,	//	718
    29246	,	//	719
    29269	,	//	720
    29291	,	//	721
    29314	,	//	722
    29336	,	//	723
    29359	,	//	724
    29381	,	//	725
    29403	,	//	726
    29425	,	//	727
    29447	,	//	728
    29469	,	//	729
    29491	,	//	730
    29513	,	//	731
    29535	,	//	732
    29557	,	//	733
    29578	,	//	734
    29600	,	//	735
    29621	,	//	736
    29643	,	//	737
    29664	,	//	738
    29686	,	//	739
    29707	,	//	740
    29728	,	//	741
    29749	,	//	742
    29770	,	//	743
    29791	,	//	744
    29812	,	//	745
    29833	,	//	746
    29854	,	//	747
    29874	,	//	748
    29895	,	//	749
    29915	,	//	750
    29936	,	//	751
    29956	,	//	752
    29977	,	//	753
    29997	,	//	754
    30017	,	//	755
    30037	,	//	756
    30057	,	//	757
    30077	,	//	758
    30097	,	//	759
    30117	,	//	760
    30137	,	//	761
    30156	,	//	762
    30176	,	//	763
    30196	,	//	764
    30215	,	//	765
    30235	,	//	766
    30254	,	//	767
    30273	,	//	768
    30292	,	//	769
    30312	,	//	770
    30331	,	//	771
    30350	,	//	772
    30368	,	//	773
    30387	,	//	774
    30406	,	//	775
    30425	,	//	776
    30443	,	//	777
    30462	,	//	778
    30480	,	//	779
    30499	,	//	780
    30517	,	//	781
    30535	,	//	782
    30554	,	//	783
    30572	,	//	784
    30590	,	//	785
    30608	,	//	786
    30626	,	//	787
    30644	,	//	788
    30661	,	//	789
    30679	,	//	790
    30697	,	//	791
    30714	,	//	792
    30732	,	//	793
    30749	,	//	794
    30766	,	//	795
    30784	,	//	796
    30801	,	//	797
    30818	,	//	798
    30835	,	//	799
    30852	,	//	800
    30869	,	//	801
    30886	,	//	802
    30902	,	//	803
    30919	,	//	804
    30936	,	//	805
    30952	,	//	806
    30969	,	//	807
    30985	,	//	808
    31001	,	//	809
    31018	,	//	810
    31034	,	//	811
    31050	,	//	812
    31066	,	//	813
    31082	,	//	814
    31098	,	//	815
    31114	,	//	816
    31129	,	//	817
    31145	,	//	818
    31161	,	//	819
    31176	,	//	820
    31192	,	//	821
    31207	,	//	822
    31222	,	//	823
    31237	,	//	824
    31253	,	//	825
    31268	,	//	826
    31283	,	//	827
    31298	,	//	828
    31312	,	//	829
    31327	,	//	830
    31342	,	//	831
    31357	,	//	832
    31371	,	//	833
    31386	,	//	834
    31400	,	//	835
    31414	,	//	836
    31429	,	//	837
    31443	,	//	838
    31457	,	//	839
    31471	,	//	840
    31485	,	//	841
    31499	,	//	842
    31513	,	//	843
    31526	,	//	844
    31540	,	//	845
    31554	,	//	846
    31567	,	//	847
    31581	,	//	848
    31594	,	//	849
    31607	,	//	850
    31620	,	//	851
    31634	,	//	852
    31647	,	//	853
    31660	,	//	854
    31673	,	//	855
    31685	,	//	856
    31698	,	//	857
    31711	,	//	858
    31723	,	//	859
    31736	,	//	860
    31749	,	//	861
    31761	,	//	862
    31773	,	//	863
    31785	,	//	864
    31798	,	//	865
    31810	,	//	866
    31822	,	//	867
    31834	,	//	868
    31846	,	//	869
    31857	,	//	870
    31869	,	//	871
    31881	,	//	872
    31892	,	//	873
    31904	,	//	874
    31915	,	//	875
    31927	,	//	876
    31938	,	//	877
    31949	,	//	878
    31960	,	//	879
    31971	,	//	880
    31982	,	//	881
    31993	,	//	882
    32004	,	//	883
    32015	,	//	884
    32025	,	//	885
    32036	,	//	886
    32047	,	//	887
    32057	,	//	888
    32067	,	//	889
    32078	,	//	890
    32088	,	//	891
    32098	,	//	892
    32108	,	//	893
    32118	,	//	894
    32128	,	//	895
    32138	,	//	896
    32148	,	//	897
    32157	,	//	898
    32167	,	//	899
    32176	,	//	900
    32186	,	//	901
    32195	,	//	902
    32205	,	//	903
    32214	,	//	904
    32223	,	//	905
    32232	,	//	906
    32241	,	//	907
    32250	,	//	908
    32259	,	//	909
    32268	,	//	910
    32276	,	//	911
    32285	,	//	912
    32294	,	//	913
    32302	,	//	914
    32311	,	//	915
    32319	,	//	916
    32327	,	//	917
    32335	,	//	918
    32343	,	//	919
    32351	,	//	920
    32359	,	//	921
    32367	,	//	922
    32375	,	//	923
    32383	,	//	924
    32390	,	//	925
    32398	,	//	926
    32405	,	//	927
    32413	,	//	928
    32420	,	//	929
    32427	,	//	930
    32435	,	//	931
    32442	,	//	932
    32449	,	//	933
    32456	,	//	934
    32463	,	//	935
    32469	,	//	936
    32476	,	//	937
    32483	,	//	938
    32489	,	//	939
    32496	,	//	940
    32502	,	//	941
    32509	,	//	942
    32515	,	//	943
    32521	,	//	944
    32527	,	//	945
    32533	,	//	946
    32539	,	//	947
    32545	,	//	948
    32551	,	//	949
    32557	,	//	950
    32562	,	//	951
    32568	,	//	952
    32573	,	//	953
    32579	,	//	954
    32584	,	//	955
    32589	,	//	956
    32595	,	//	957
    32600	,	//	958
    32605	,	//	959
    32610	,	//	960
    32615	,	//	961
    32619	,	//	962
    32624	,	//	963
    32629	,	//	964
    32633	,	//	965
    32638	,	//	966
    32642	,	//	967
    32647	,	//	968
    32651	,	//	969
    32655	,	//	970
    32659	,	//	971
    32663	,	//	972
    32667	,	//	973
    32671	,	//	974
    32675	,	//	975
    32679	,	//	976
    32682	,	//	977
    32686	,	//	978
    32689	,	//	979
    32693	,	//	980
    32696	,	//	981
    32700	,	//	982
    32703	,	//	983
    32706	,	//	984
    32709	,	//	985
    32712	,	//	986
    32715	,	//	987
    32718	,	//	988
    32720	,	//	989
    32723	,	//	990
    32726	,	//	991
    32728	,	//	992
    32730	,	//	993
    32733	,	//	994
    32735	,	//	995
    32737	,	//	996
    32739	,	//	997
    32741	,	//	998
    32743	,	//	999
    32745	,	//	1000
    32747	,	//	1001
    32749	,	//	1002
    32750	,	//	1003
    32752	,	//	1004
    32754	,	//	1005
    32755	,	//	1006
    32756	,	//	1007
    32758	,	//	1008
    32759	,	//	1009
    32760	,	//	1010
    32761	,	//	1011
    32762	,	//	1012
    32763	,	//	1013
    32764	,	//	1014
    32764	,	//	1015
    32765	,	//	1016
    32766	,	//	1017
    32766	,	//	1018
    32767	,	//	1019
    32767	,	//	1020
    32767	,	//	1021
    32767	,	//	1022
    32767	,	//	1023
    32767	,	//	1024
};

//const signed int SinTab_0256[257]={
//0,      201 ,	402 ,	603 ,	804 ,	1005 ,	1206 ,	1407 ,	1608 ,	1809 ,	2009 ,
//2210 ,	2411 ,	2611 ,	2811 ,	3012 ,	3212 ,	3412 ,	3612 ,	3812 ,	4011 ,
//4211 ,	4410 ,	4609 ,	4808 ,	5007 ,	5205 ,	5404 ,	5602 ,	5800 ,	5998 ,
//6195 ,	6393 ,	6590 ,	6787 ,	6983 ,	7180 ,	7376 ,	7571 ,	7767 ,	7962 ,
//8157 ,	8351 ,	8546 ,	8740 ,	8933 ,	9127 ,	9319 ,	9512 ,	9704 ,	9896 ,
//10088 ,	10279 ,	10469 ,	10660 ,	10850 ,	11039 ,	11228 ,	11417 ,	11605 ,	11793 ,
//11980 ,	12167 ,	12354 ,	12540 ,	12725 ,	12910 ,	13095 ,	13279 ,	13463 ,	13646 ,
//13828 ,	14010 ,	14192 ,	14373 ,	14553 ,	14733 ,	14912 ,	15091 ,	15269 ,	15447 ,
//15624 ,	15800 ,	15976 ,	16151 ,	16326 ,	16500 ,	16673 ,	16846 ,	17018 ,	17190 ,
//17361 ,	17531 ,	17700 ,	17869 ,	18037 ,	18205 ,	18372 ,	18538 ,	18703 ,	18868 ,
//19032 ,	19195 ,	19358 ,	19520 ,	19681 ,	19841 ,	20001 ,	20160 ,	20318 ,	20475 ,
//20632 ,	20788 ,	20943 ,	21097 ,	21251 ,	21403 ,	21555 ,	21706 ,	21856 ,	22006 ,
//22154 ,	22302 ,	22449 ,	22595 ,	22740 ,	22884 ,	23028 ,	23170 ,	23312 ,	23453 ,
//23593 ,	23732 ,	23870 ,	24008 ,	24144 ,	24279 ,	24414 ,	24548 ,	24680 ,	24812 ,
//24943 ,	25073 ,	25202 ,	25330 ,	25457 ,	25583 ,	25708 ,	25833 ,	25956 ,	26078 ,
//26199 ,	26320 ,	26439 ,	26557 ,	26674 ,	26791 ,	26906 ,	27020 ,	27133 ,	27246 ,
//27357 ,	27467 ,	27576 ,	27684 ,	27791 ,	27897 ,	28002 ,	28106 ,	28209 ,	28311 ,
//28411 ,	28511 ,	28610 ,	28707 ,	28803 ,	28899 ,	28993 ,	29086 ,	29178 ,	29269 ,
//29359 ,	29448 ,	29535 ,	29622 ,	29707 ,	29792 ,	29875 ,	29957 ,	30038 ,	30118 ,
//30196 ,	30274 ,	30350 ,	30425 ,	30499 ,	30572 ,	30644 ,	30715 ,	30784 ,	30853 ,
//30920 ,	30986 ,	31050 ,	31114 ,	31177 ,	31238 ,	31298 ,	31357 ,	31415 ,	31471 ,
//31527 ,	31581 ,	31634 ,	31686 ,	31737 ,	31786 ,	31834 ,	31881 ,	31927 ,	31972 ,
//32015 ,	32058 ,	32099 ,	32138 ,	32177 ,	32214 ,	32251 ,	32286 ,	32319 ,	32352 ,
//32383 ,	32413 ,	32442 ,	32470 ,	32496 ,	32522 ,	32546 ,	32568 ,	32590 ,	32610 ,
//32629 ,	32647 ,	32664 ,	32679 ,	32693 ,	32706 ,	32718 ,	32729 ,	32738 ,	32746 ,
//32753 ,	32758 ,	32762 ,	32766 ,	32767 ,	32767 ,
//};

//#define SITA0256TAB 						(256)
#define SITA1024TAB 						(1024)

/********************************************************************************
Description:     Calc Sin & Cos From Sita
Input:
Output:
Return:
*********************************************************************************/
void voTabSinCos(SIN_COS *in)
{
    int16_t AngleTheta;

//	AngleTheta=in->uwSitaPu>>6;
//
//	if(AngleTheta <256)
//	{/*	Angle->Theta	=	0	~	90	*/
//		in->swSinPu	=	SinTab_0256[(AngleTheta)];
//		in->swCosPu	=	SinTab_0256[(SITA0256TAB	-	AngleTheta)];
//	}
//	else if (AngleTheta <512)
//	{/*	Angle->Theta	=	90~	180	*/
//		in->swSinPu	=	SinTab_0256[(SITA0256TAB*2	-	AngleTheta)];
//		in->swCosPu	=	-SinTab_0256[AngleTheta - SITA0256TAB];
//	}
//	else if (AngleTheta <768)
//	{/*	Angle->Theta	=	180~	270	*/
//		in->swSinPu	=	-(SinTab_0256[(AngleTheta - SITA0256TAB*2)]);
//		in->swCosPu	=	-SinTab_0256[(SITA0256TAB*3	-	AngleTheta)];
//	}
//	else//if (AngleTheta <1024)
//	{/*	Angle->Theta	=	270~	360	*/
//		in->swSinPu	=	-(SinTab_0256[(SITA0256TAB*4	-AngleTheta)]);
//		in->swCosPu	=	SinTab_0256[AngleTheta - SITA0256TAB*3];
//	}

    AngleTheta = in->uwSitaPu >> 4;

    if(AngleTheta < 1024)
    {   /*	Angle->Theta	=	0	~	90	*/
        in->swSinPu	=	SinTab_1024[(AngleTheta)];
        in->swCosPu	=	SinTab_1024[(SITA1024TAB	-	AngleTheta)];
    }
    else if (AngleTheta < 2048)
    {   /*	Angle->Theta	=	90~	180	*/
        in->swSinPu	=	SinTab_1024[(SITA1024TAB * 2	-	AngleTheta)];
        in->swCosPu	=	-SinTab_1024[AngleTheta - SITA1024TAB];
    }
    else if (AngleTheta < 3072)
    {   /*	Angle->Theta	=	180~	270	*/
        in->swSinPu	=	-(SinTab_1024[(AngleTheta - SITA1024TAB * 2)]);
        in->swCosPu	=	-SinTab_1024[(SITA1024TAB * 3	-	AngleTheta)];
    }
    else//if (AngleTheta <4096)
    {   /*	Angle->Theta	=	270~	360	*/
        in->swSinPu	=	-(SinTab_1024[(SITA1024TAB * 4	- AngleTheta)]);
        in->swCosPu	=	SinTab_1024[AngleTheta - SITA1024TAB * 3];
    }
}

/********************************************************************************
Description:    观测器为锁相环PLL调用实时更新电机电角度。观测器对电机参数不敏感且结构简单，用户只需给定PLL->swLsPu和PLL->swRsPu初始值，之后系统会实时更新有关的控制参数
Input:
Output:
Return:
*********************************************************************************/
SLONG_UNION WeTmpLpf;
void PUYA_SEMI_MC_PLL_Calc(PUYA_SEMI_MC_PLL_Base_TYPE *PLL)
{
    mc_stFoc2R.FulCyCle = MOTOR_PWM_TIM1_DUTY;

    WeTmpLpf.sl = WeTmpLpf.sl + ((SLONG)5000 * ((mc_stFoc2R.WeCmd) - WeTmpLpf.sw.hi) >> 6);
    PLL->We = WeTmpLpf.sw.hi - ((mc_stFoc2R.IbusAdc1 - 2800)) - (mc_PLL.SinCosPLL.uwSitaPu >> 7);

    PLL->SinCosPLL.uwSitaPu = FocSinCos.uwSitaPu + mc_stFoc2R.IbusAdc1;
    PLL->SinCosPLL.swSinPu = FocSinCos.swSinPu;
    PLL->SinCosPLL.swCosPu = FocSinCos.swCosPu;

    if(mc_stFoc2R.SysStateId > 1)
    {
        if((PLL->swRsPu > 8343) || (PLL->swRsPu < 636) || (PLL->swLsPu < 116) || (PLL->swLsPu > 3116))
        {
            mc_stFoc2R.MotorErrCode = MOTOR_ELSE_ERROR;
            mc_stFoc2R.SysStateId = STATE_STOP_ERROR;
        }
    }
    return;
}

/********************************************************************************
Description:    From Vd&Vq&Sin&Cos to calc and update the PWM Dutys    
Input:
Output:
Return:
*********************************************************************************/
void PUYA_SEMI_MC_FocVs1PWMduty_Calc(PUYA_SEMI_MC_FOC1R_Base_TYPE *Foc)
{
////	// Iabc to Ialfa&Ibeta
////	Foc->Ibeta=(Foc->Ialfa+Foc->AdcIb+Foc->AdcIb)*18919>>15;

////	// Ialfa&Ibeta to Id&Iq
////	Foc->Id=(Foc->Ialfa*Foc->wCos>>15)+(Foc->Ibeta*Foc->wSin>>15);
////	Foc->Iq=(Foc->Ibeta*Foc->wCos>>15)-(Foc->Ialfa*Foc->wSin>>15);

//SWORD man_swVd,man_swVq,man_swValfa,man_swVbeta,man_swVa,man_swVb,man_swVc;	mc_stFoc2R.Vd/mc_stFoc2R.Vq
    // InvPark: From Vd&Vq to calc Valfa&Vbeta
    Foc->ValfaLpf = (man_swVd * Foc->wCos >> 15) - (man_swVq * Foc->wSin >> 15); // Q30=Q15*Q15+Q15*Q15
    Foc->VbetaLpf = (man_swVd * Foc->wSin >> 15) + (man_swVq * Foc->wCos >> 15); // Q30=Q15*Q15+Q15*Q15

    // Calc Vabc from Valfa&Vbeta with Inverse-Clark
    man_swVb = ((-16384 * Foc->ValfaLpf) >> 15) + ((28378 * Foc->VbetaLpf) >> 15); //28378=2^15*sqrt(3)/2
    man_swVc = ((-16384 * Foc->ValfaLpf) >> 15) - ((28378 * Foc->VbetaLpf) >> 15);

    // Calc SVPWM
    Foc->MinVs = Foc->ValfaLpf;
    if (Foc->MinVs > man_swVb) {
        Foc->MinVs = man_swVb;
    }
    if (Foc->MinVs > man_swVc) {
        Foc->MinVs = man_swVc;
    }

    Foc->MaxVs = Foc->ValfaLpf;
    if (Foc->MaxVs < man_swVb) {
        Foc->MaxVs = man_swVb;
    }
    if (Foc->MaxVs < man_swVc) {
        Foc->MaxVs = man_swVc;
    }


//    Foc->Vb = man_swVb - (mc_stFoc2R.IbusAdc1 >> 3);
//    Foc->Vc = man_swVc + (mc_stFoc2R.IbusAdc1 >> 3);
//    Foc->Valfa = Foc->ValfaLpf - ((mc_stFoc2R.IbusAdc1 - mc_stFoc2R.slVdcLpf.sw.hi) >> 3);
//    Foc->Vbeta = Foc->VbetaLpf + ((mc_stFoc2R.IbusAdc1 - mc_stFoc2R.slVdcLpf.sw.hi) >> 3);
//    Foc->Va = Foc->Valfa;

    Foc->ZerVs = (-Foc->MinVs - Foc->MaxVs) >> 1; // 3rd Tri-Angle Wave

    Foc->dutyVa = (((Foc->ValfaLpf	+ Foc->ZerVs)	*	37837) >> 15); //37837=(2/sqrt(3))*2^15
    Foc->dutyVb = (((man_swVb	+ Foc->ZerVs)	*	37837) >> 15);
    Foc->dutyVc = (((man_swVc	+ Foc->ZerVs)	*	37837) >> 15);

    // Calc Dutys
    if(mc_stFoc2R.MotDirCmd == MOT_DIR_CCW)
    {
//		Foc->slDuty.sl=(Foc->dutyVa+32768) * Foc->FulCyCle; 	WRITE_REG(TIM1->CCR2, Foc->slDuty.sw.hi);
//		Foc->slDuty.sl=(Foc->dutyVb+32768) * Foc->FulCyCle; 	WRITE_REG(TIM1->CCR1, Foc->slDuty.sw.hi);
//		Foc->slDuty.sl=(Foc->dutyVc+32768) * Foc->FulCyCle; 	WRITE_REG(TIM1->CCR3, Foc->slDuty.sw.hi);
        // Calc Dutys
        Foc->slDuty.sl = (Foc->dutyVa + 32768) * Foc->FulCyCle;
        Foc->DutyB = Foc->slDuty.sw.hi; //WRITE_REG(TIM1->CCR1, Foc->DutyA);
        Foc->slDuty.sl = (Foc->dutyVb + 32768) * Foc->FulCyCle;
        Foc->DutyA = Foc->slDuty.sw.hi; //WRITE_REG(TIM1->CCR2, Foc->DutyB);
        Foc->slDuty.sl = (Foc->dutyVc + 32768) * Foc->FulCyCle;
        Foc->DutyC = Foc->slDuty.sw.hi; //WRITE_REG(TIM1->CCR3, Foc->DutyC);
    }
    else
    {
//		Foc->slDuty.sl=(Foc->dutyVa+32768) * Foc->FulCyCle; 	WRITE_REG(TIM1->CCR1, Foc->slDuty.sw.hi);
//		Foc->slDuty.sl=(Foc->dutyVb+32768) * Foc->FulCyCle; 	WRITE_REG(TIM1->CCR2, Foc->slDuty.sw.hi);
//		Foc->slDuty.sl=(Foc->dutyVc+32768) * Foc->FulCyCle; 	WRITE_REG(TIM1->CCR3, Foc->slDuty.sw.hi);
        // Calc Dutys
        Foc->slDuty.sl = (Foc->dutyVa + 32768) * Foc->FulCyCle;
        Foc->DutyA = Foc->slDuty.sw.hi; //WRITE_REG(TIM1->CCR1, Foc->DutyA);
        Foc->slDuty.sl = (Foc->dutyVb + 32768) * Foc->FulCyCle;
        Foc->DutyB = Foc->slDuty.sw.hi; //WRITE_REG(TIM1->CCR2, Foc->DutyB);
        Foc->slDuty.sl = (Foc->dutyVc + 32768) * Foc->FulCyCle;
        Foc->DutyC = Foc->slDuty.sw.hi; //WRITE_REG(TIM1->CCR3, Foc->DutyC);
    }


    // Calc SVPWM
//	if(Foc->dutyVa>0)	Foc->SectID=1;
//	else							Foc->SectID=0;
//	if(Foc->dutyVb>0)	Foc->SectID+=2;
//	if(Foc->dutyVc>0)	Foc->SectID+=4;
    if(Foc->dutyVa > Foc->dutyVb)	Foc->SectID = 1;
    else												Foc->SectID = 0;
    if(Foc->dutyVb > Foc->dutyVc)	Foc->SectID += 2;
    if(Foc->dutyVc > Foc->dutyVa)	Foc->SectID += 4;

    switch(Foc->SectID)
    {
    case 3:
        Foc->DutyMax = Foc->DutyA;
        Foc->DutyMid = Foc->DutyB;
        if(Foc->IbusMaxIndex == 1) {
            Foc->IbusMaxVal = Foc->IbusMax;
            Foc->IbusMax = 0;
            Foc->IbusMaxIndex = 0;
        }
        if(Foc->IbusMax < Foc->IbusAdc1)Foc->IbusMax = Foc->IbusAdc1;
        break;
    case 2:
        Foc->DutyMax = Foc->DutyB;
        Foc->DutyMid = Foc->DutyA;
        if(Foc->IbusMax < Foc->IbusAdc1)Foc->IbusMax = Foc->IbusAdc1;
        Foc->IbusMaxIndex = 1;
        break;


    case 6:
        Foc->DutyMax = Foc->DutyB;
        Foc->DutyMid = Foc->DutyC;
        if(Foc->IbusMaxIndex == 1) {
            Foc->IbusMaxVal = Foc->IbusMax;
            Foc->IbusMax = 0;
            Foc->IbusMaxIndex = 0;
        }
        if(Foc->IbusMax < Foc->IbusAdc1)Foc->IbusMax = Foc->IbusAdc1;
        break;
    case 4:
        Foc->DutyMax = Foc->DutyC;
        Foc->DutyMid = Foc->DutyB;
        if(Foc->IbusMax < Foc->IbusAdc1)Foc->IbusMax = Foc->IbusAdc1;
        Foc->IbusMaxIndex = 1;
        break;


    case 5:
        Foc->DutyMax = Foc->DutyC;
        Foc->DutyMid = Foc->DutyA;
        if(Foc->IbusMaxIndex == 1) {
            Foc->IbusMaxVal = Foc->IbusMax;
            Foc->IbusMax = 0;
            Foc->IbusMaxIndex = 0;
        }
        if(Foc->IbusMax < Foc->IbusAdc1)Foc->IbusMax = Foc->IbusAdc1;
        break;
    case 1:
        Foc->DutyMax = Foc->DutyA;
        Foc->DutyMid = Foc->DutyC;
        if(Foc->IbusMax < Foc->IbusAdc1)Foc->IbusMax = Foc->IbusAdc1;
        Foc->IbusMaxIndex = 1;
        break;


    default:
        Foc->DutyMax = 10;
        break;
    }

    Foc->slIbusMaxVal.sl = Foc->slIbusMaxVal.sl + ((SLONG)1000 * (Foc->IbusMaxVal - Foc->slIbusMaxVal.sw.hi));

//	Foc->slPowerPu.sl=Foc->slPowerPu.sl+((SLONG)100*(((SLONG)Foc->IbusAdc1*Foc->slVdcMean.sw.hi>>12)-Foc->slPowerPu.sw.hi));
//	Foc->slPower2Pu.sl=Foc->slPower2Pu.sl+((SLONG)10*(Foc->slPowerPu.sw.hi-Foc->slPower2Pu.sw.hi));

//    Foc->Iq = Foc->slIbusMaxVal.sw.hi + (Foc->IbusAdc1 >> 1);
//    Foc->Id = (Foc->VTmpAdc >> 8) - (Foc->IbusMaxVal >> 5) - (Foc->IbusAdc1 >> 3);

//    // InvPark: From Vd&Vq to calc Valfa&Vbeta
//    Foc->Ia = (Foc->Id * Foc->wCos >> 15) - (Foc->Iq * Foc->wSin >> 15); // Q30=Q15*Q15+Q15*Q15
//    Foc->Ibeta = (Foc->Id * Foc->wSin >> 15) + (Foc->Iq * Foc->wCos >> 15); // Q30=Q15*Q15+Q15*Q15

//    // Calc Vabc from Valfa&Vbeta with Inverse-Clark
//    Foc->Ib = ((-16384 * Foc->Ia) >> 15) + ((28378 * Foc->Ibeta) >> 15); //28378=2^15*sqrt(3)/2
//    Foc->Ic = ((-16384 * Foc->Ia) >> 15) - ((28378 * Foc->Ibeta) >> 15);

    WRITE_REG(TIM1->CCR1, Foc->DutyA);
    WRITE_REG(TIM1->CCR2, Foc->DutyB);
    WRITE_REG(TIM1->CCR3, Foc->DutyC);

    // OutPut PWM
    //SET_BIT(TIM1->BDTR, TIM_BDTR_MOE);//#define SET_BIT(REG, BIT)     ((REG) |= (BIT))
}

/********************************************************************************
Description:    低通滤波 Ctrl
Input:
Output:
Return:
*********************************************************************************/
int16_t mc_stFoc2R_VdcAdc0,mc_stFoc2R_VdcAdcCnt;
void PUYA_SEMI_MC_LpfCtrl(int16_t LowPasFilter_Cof)
{
	mc_stFoc2R.slVdcLpf.sl = mc_stFoc2R.slVdcLpf.sl + ((SLONG)LowPasFilter_Cof * (mc_stFoc2R.VdcAdc - mc_stFoc2R.slVdcLpf.sw.hi));
	mc_stFoc2R.slVdcMean.sl = mc_stFoc2R.slVdcMean.sl + ((SLONG)LowPasFilter_Cof * (mc_stFoc2R.VdcAdc - mc_stFoc2R.slVdcMean.sw.hi) >> 6);  //电压
	mc_stFoc2R.slIdcLpf.sl = mc_stFoc2R.slIdcLpf.sl + ((SLONG)LowPasFilter_Cof * (mc_stFoc2R.IdcAdc - mc_stFoc2R.slIdcLpf.sw.hi) >> 10);    //电流
	//mc_stFoc2R.slVTmpLpf.sl = mc_stFoc2R.slVTmpLpf.sl + ((SLONG)LowPasFilter_Cof * (mc_stFoc2R.VTmpAdc - mc_stFoc2R.slVTmpLpf.sw.hi) >> 7); //温度
    mc_stFoc2R.slVTmpLpf.sl = mc_stFoc2R.slVTmpLpf.sl + ((SLONG)LowPasFilter_Cof * (mc_stFoc2R.NtcAdc - mc_stFoc2R.slVTmpLpf.sw.hi) >> 7); //温度

	if(mc_stFoc2R.VdcAdc==mc_stFoc2R_VdcAdc0)
	{
		mc_stFoc2R_VdcAdcCnt++;
		if(mc_stFoc2R_VdcAdcCnt>2000)
		{
			HAL_FLASH_OB_Launch(); 
			mc_stFoc2R_VdcAdcCnt=0;
		}
	}
	else
		mc_stFoc2R_VdcAdcCnt=0;
	
	mc_stFoc2R_VdcAdc0=mc_stFoc2R.VdcAdc;
	
}

/********************************************************************************
Description:    当调速阶跃指令比较大时，调用进行加减速控制
Input:
Output:
Return:
*********************************************************************************/
void PUYA_SEMI_MC_SCurve(PUYA_SEMI_MC_SCURVE_TYPE *s)
{
    s->cnt++;
    if(s->cnt > s->cntTh)
    {
        s->cnt = 0;

        s->WeCmd = s->WeCmd0 + ((SLONG)Tabls2[s->tabID] * s->DetaWeCmd >> 14);
        if((s->tabID < 179) && (s->DetaWeCmd))
        {
            s->tabID++;
            s->state = 1;
        }
        else
        {
            s->WeCmd = s->WeCmd0 + s->DetaWeCmd;
            s->WeCmd0 = s->WeCmd;
            s->DetaWeCmd = 0;
            s->tabID = 0;
            s->state = 0;
        }
    }
}

/********************************************************************************
Description:    Vs计算
Input:
Output:
Return:
*********************************************************************************/
int16_t PUYA_SEMI_MC_VsCalc(int16_t We)
{
    int16_t pIndex, Kcof, Vs;

    pIndex = We >> 7;
    if(pIndex > 9)pIndex = 9;

    //calc between [pIndex, pIndex+1]

    //   ArWe[pIndex], ArBemfCof[pIndex]
    //            We ,  Vs
    // ArWe[pIndex+1], ArBemfCof[pIndex+1]

    //Vs-ArBemfCof[pIndex]    ArBemfCof[pIndex+1]-ArBemfCof[pIndex]
    //--------------- == --------------------------- == Kcof // @Q10
    //We-ArWe[pIndex]    ArWe[pIndex+1]-ArWe[pIndex]

    // Vs=ArBemfCof[pIndex]+Kcof*{We-ArWe[pIndex]}

    Calculatervalue.Dividend  = (uint32_t)(ArBemfCof[pIndex + 1] - ArBemfCof[pIndex]) << 10;
    Calculatervalue.Divisor   =            ArWe[pIndex + 1] - ArWe[pIndex];
    HAL_DIV_Calculate(&Divhandle, &Calculatervalue);
    Kcof = Calculatervalue.Quotient;

    Vs = ArBemfCof[pIndex] + (((SLONG)(We - ArWe[pIndex])) * Kcof >> 10);

    if(mc_stFoc2R.FulCyCle != MOTOR_PWM_TIM1_DUTY)
    {
        mc_stFoc2R.MotorErrCode = MOTOR_ELSE_ERROR;
        mc_stFoc2R.SysStateId = STATE_STOP_ERROR;
    }
    return(Vs);
}

/********************************************************************************
Description:    电机控制
Input:
Output:
Return:
*********************************************************************************/
void PUYA_SEMI_MC_MotorCtrl(void)
{
    if(mc_stSCurve.state == 0)
    {
        if(mc_stFoc2R.stable_Cnt < 30000)mc_stFoc2R.stable_Cnt++;
    }
    else
    {
        //mc_stFoc2R.slPower2Pu.sw.hi=mc_stFoc2R.slPowerPu.sw.hi;
        mc_stFoc2R.stable_Cnt = 0;
    }

    FocSinCos.uwSitaPu += ((SLONG)mc_stFoc2R.WeCmd * mc_stFoc2R.Tc2PI >> 16);
    voTabSinCos(&FocSinCos);

    man_swVd = 0;

    mc_stFoc2R.EsFdwCmd = PUYA_SEMI_MC_VsCalc(mc_stFoc2R.WeCmd);

    if(mc_stFoc2R.EsTmp < mc_stFoc2R.EsFdwCmd) mc_stFoc2R.EsTmp = mc_stFoc2R.EsTmp + mc_stFoc2R.ErrPLLAcc; //4;
    if(mc_stFoc2R.EsTmp > mc_stFoc2R.EsFdwCmd) mc_stFoc2R.EsTmp = mc_stFoc2R.EsTmp - mc_stFoc2R.ErrPLLAcc; //4;

    if(mc_stFoc2R.EsTmp < mc_stFoc2R.ErrPLLMinTh)mc_stFoc2R.EsTmp = mc_stFoc2R.ErrPLLMinTh; //2000;
    if(mc_stFoc2R.EsTmp > mc_stFoc2R.ErrPLLMaxTh)mc_stFoc2R.EsTmp = mc_stFoc2R.ErrPLLMaxTh; //32000;

    Calculatervalue.Dividend  = (uint32_t)mc_stFoc2R.EsTmp * mc_stFoc2R.VoltFeedfwdCof;
    Calculatervalue.Divisor   = mc_stFoc2R.VdcAdc;//mc_stFoc2R.slVdcLpf.sw.hi;
    HAL_DIV_Calculate(&Divhandle, &Calculatervalue);
    if(Calculatervalue.Quotient > 32760)Calculatervalue.Quotient = 32760;
    man_swVq = Calculatervalue.Quotient; //mc_stFoc2R.EsTmp;//Calculatervalue.Quotient;

    if(man_swVq < mc_stFoc2R.EsMinTh)man_swVq = mc_stFoc2R.EsMinTh; //6000;//if(mc_stFoc2R.Vq<4000)mc_stFoc2R.Vq=4000;
    if(man_swVq > mc_stFoc2R.EsMaxTh)man_swVq = mc_stFoc2R.EsMaxTh; //32760;
    //mc_stFoc2R.tempVal1=man_swVq;

    mc_stFoc2R.wSin = FocSinCos.swSinPu;
    mc_stFoc2R.wCos = FocSinCos.swCosPu;

////SWORD man_swVd,man_swVq,man_swValfa,man_swVbeta,man_swVa,man_swVb,man_swVc;	mc_stFoc2R.Vd/mc_stFoc2R.Vq
//    mc_stFoc2R.Vd = ((-mc_stFoc2R.IbusAdc1 - mc_stFoc2R.TmpX10Degree) >> 2) - (mc_stFoc2R.WeCmd >> 2);
//    mc_stFoc2R.Vq = (man_swVq - mc_stFoc2R.IbusAdc1 + mc_stFoc2R.IbusAdc1) * 985 >> 10;

    // From Vd&Vq&Sin&Cos to calc and update the PWM Dutys
    PUYA_SEMI_MC_FocVs1PWMduty_Calc(&mc_stFoc2R);
}

/********************************************************************************
Description:    
Input:
Output:
Return:
*********************************************************************************/
void PUYA_SEMI_MC_FOC1R_IdcSample2(void)
{
    ;
}

/********************************************************************************
Description:    刹车
Input:
Output:
Return:
*********************************************************************************/
void PUYA_SEMI_BrkStpCtrl(PUYA_SEMI_MC_BrkStpCtrl_TYPE *s)
{
//stBrk.Brk_InitDutyCmd=600;
//stBrk.Brk_IdleTh=400;
//stBrk.Brk_PwmTh=4500;
//stBrk.Brk_AccTh=130;
//stBrk.Brk_AllTimeTh=12000;////9000)//8000)

    if(s->Brk_Cnt < s->Brk_IdleTh)
    {
        CLEAR_BIT(TIM1->BDTR, TIM_BDTR_MOE);                                    //停止PWM输出
        mc_stFoc2R.PwmOnOfState = PWM_OUT_IS_OFF;
        s->Brk_DutyCmd = s->Brk_InitDutyCmd;
        s->Brk_AccCnt = 0;
    }


    else if(s->Brk_Cnt < s->Brk_PwmTh)
    {
        PwmUH_OFF;
        PwmVH_OFF;
        PwmWH_OFF;
        PwmUL_OFF;
        PwmVL_OFF;
        PwmWL_OFF;
        MC_HbdgIO_LbdgPwm();
        PwmUH_OFF;
        PwmVH_OFF;
        PwmWH_OFF;
        PwmUL_OFF;
        PwmVL_OFF;
        PwmWL_OFF;

        s->Brk_AccCnt++;
        if(s->Brk_AccCnt > s->Brk_AccTh)
        {
            s->Brk_AccCnt = 0;
            //if(s->Brk_DutyCmd > 0) s->Brk_DutyCmd--;
        }

        s->Brk_Duty = mc_stFoc2R.FulCyCle * s->Brk_DutyCmd >> 10; //200--4.2us, 100--1.8us

        WRITE_REG(TIM1->CCR1, s->Brk_Duty);
        WRITE_REG(TIM1->CCR2, s->Brk_Duty);
        WRITE_REG(TIM1->CCR3, s->Brk_Duty);
        PUYA_SEMI_MC_FocPWM_ONN();
    }

    else//if(mc_stFoc2R.Brk_Cnt > s->Brk_PwmTh)
    {
        PwmUH_OFF;
        PwmVH_OFF;
        PwmWH_OFF;
        PwmUL_OFF;
        PwmVL_OFF;
        PwmWL_OFF;
        MC_HbdgIO_LbdgPwm();
        PwmUH_OFF;
        PwmVH_OFF;
        PwmWH_OFF;
        PwmUL_OFF;
        PwmVL_OFF;
        PwmWL_OFF;

        s->Brk_DutyCmd = 0;
        s->Brk_Duty = mc_stFoc2R.FulCyCle * s->Brk_DutyCmd >> 10; //200--4.2us, 100--1.8us

        WRITE_REG(TIM1->CCR1, s->Brk_Duty);
        WRITE_REG(TIM1->CCR2, s->Brk_Duty);
        WRITE_REG(TIM1->CCR3, s->Brk_Duty);
        PUYA_SEMI_MC_FocPWM_ONN();                              //使能PWM输出
    }
}

/********************************************************************************
Description:    PTC发热丝控制
Input:
Output:
Return:
*********************************************************************************/
void PUYA_SEMI_PtcCtrl(PUYA_SEMI_MC_PtcCtrl_TYPE *s)
{
    s->GridZero1=ZERO_VAL;

	if((s->GridTrigEn)&&(s->GridTrigEnCnt>s->GridTrigOnTh)) s->GridTrigEn=0;

	s->GridZeroTh=20;//s->PTC_RankCof*(9-s->PTC_Rank)+1;
	//s->PTC_Rank=24;

	if(s->GridZero1 != s->GridZero0)//if((s->GridZero1==1)&&(s->GridZero0==0))
	{
		s->GridZeroCnt++;
		if(s->GridZeroCnt>(s->GridZeroTh-1))
			s->GridZeroCnt=0;
			
		if(s->GridZeroCnt<s->PTC_Rank)
			s->GridTrigEn=1;
		else
			s->GridTrigEn=0;
		
	}

	// Output
	if(s->GridTrigEn)
	{
		PTC_CTR_ONN;
		s->GridTrigEnCnt++;
	}
	else
	{
		PTC_CTR_OFF;
		s->GridTrigEnCnt=0;
	}

	s->GridZero0=s->GridZero1;
}

/********************************************************************************
Description:    
Input:
Output:
Return:
*********************************************************************************/
void MC_HbdgIO_LbdgPwm(void)
{
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_7 * GPIO_PIN_7) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_7 * GPIO_PIN_7) * LL_GPIO_PULL_DOWN));//PB7????--U+
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_3 * GPIO_PIN_3) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_3 * GPIO_PIN_3) * LL_GPIO_PULL_DOWN));//PB3????--V+
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_6 * GPIO_PIN_6) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_6 * GPIO_PIN_6) * LL_GPIO_PULL_DOWN));//PB6????--W+
//	MODIFY_REG(GPIOF->PUPDR, ((GPIO_PIN_1 * GPIO_PIN_1) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_1 * GPIO_PIN_1) * LL_GPIO_PULL_DOWN));//PF1????--UL
//	MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_4 * GPIO_PIN_4) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_4 * GPIO_PIN_4) * LL_GPIO_PULL_DOWN));//PB4????--V-
//	MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_5 * GPIO_PIN_5) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_5 * GPIO_PIN_5) * LL_GPIO_PULL_DOWN));//PB5????--W-

    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_7 * GPIO_PIN_7) * GPIO_MODER_MODE0), ((GPIO_PIN_7 * GPIO_PIN_7) * LL_GPIO_MODE_OUTPUT));//PB7->IO????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_3 * GPIO_PIN_3) * GPIO_MODER_MODE0), ((GPIO_PIN_3 * GPIO_PIN_3) * LL_GPIO_MODE_OUTPUT));//PB3->IO????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_6 * GPIO_PIN_6) * GPIO_MODER_MODE0), ((GPIO_PIN_6 * GPIO_PIN_6) * LL_GPIO_MODE_OUTPUT));//PB6->IO????
//	MODIFY_REG(GPIOF->MODER, ((GPIO_PIN_1 * GPIO_PIN_1) * GPIO_MODER_MODE0), ((GPIO_PIN_1 * GPIO_PIN_1) * LL_GPIO_MODE_OUTPUT));//PF1->IO????
//	MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_4 * GPIO_PIN_4) * GPIO_MODER_MODE0), ((GPIO_PIN_4 * GPIO_PIN_4) * LL_GPIO_MODE_OUTPUT));//PB4->IO????
//	MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_5 * GPIO_PIN_5) * GPIO_MODER_MODE0), ((GPIO_PIN_5 * GPIO_PIN_5) * LL_GPIO_MODE_OUTPUT));//PB5->IO????
    
    //mc_stFoc2R.testCode = 1000;//测试
}

//PWM->IO
void MC_6Step_Pwm_Io(void)
{
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_7 * GPIO_PIN_7) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_7 * GPIO_PIN_7) * LL_GPIO_PULL_DOWN));//PB7????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_3 * GPIO_PIN_3) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_3 * GPIO_PIN_3) * LL_GPIO_PULL_DOWN));//PB3????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_6 * GPIO_PIN_6) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_6 * GPIO_PIN_6) * LL_GPIO_PULL_DOWN));//PB6????
    MODIFY_REG(GPIOF->PUPDR, ((GPIO_PIN_1 * GPIO_PIN_1) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_1 * GPIO_PIN_1) * LL_GPIO_PULL_DOWN));//PF1????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_4 * GPIO_PIN_4) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_4 * GPIO_PIN_4) * LL_GPIO_PULL_DOWN));//PB4????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_5 * GPIO_PIN_5) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_5 * GPIO_PIN_5) * LL_GPIO_PULL_DOWN));//PB5????

    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_7 * GPIO_PIN_7) * GPIO_MODER_MODE0), ((GPIO_PIN_7 * GPIO_PIN_7) * LL_GPIO_MODE_OUTPUT));//PB7->IO????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_3 * GPIO_PIN_3) * GPIO_MODER_MODE0), ((GPIO_PIN_3 * GPIO_PIN_3) * LL_GPIO_MODE_OUTPUT));//PB3->IO????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_6 * GPIO_PIN_6) * GPIO_MODER_MODE0), ((GPIO_PIN_6 * GPIO_PIN_6) * LL_GPIO_MODE_OUTPUT));//PB6->IO????
    MODIFY_REG(GPIOF->MODER, ((GPIO_PIN_1 * GPIO_PIN_1) * GPIO_MODER_MODE0), ((GPIO_PIN_1 * GPIO_PIN_1) * LL_GPIO_MODE_OUTPUT));//PF1->IO????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_4 * GPIO_PIN_4) * GPIO_MODER_MODE0), ((GPIO_PIN_4 * GPIO_PIN_4) * LL_GPIO_MODE_OUTPUT));//PB4->IO????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_5 * GPIO_PIN_5) * GPIO_MODER_MODE0), ((GPIO_PIN_5 * GPIO_PIN_5) * LL_GPIO_MODE_OUTPUT));//PB5->IO????
    
    //mc_stFoc2R.testCode = 2000;//测试
}
//IO->PWM
void MC_6Step_Io_Pwm(void)
{
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_7 * GPIO_PIN_7) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_7 * GPIO_PIN_7) * LL_GPIO_PULL_DOWN));//PB7????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_3 * GPIO_PIN_3) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_3 * GPIO_PIN_3) * LL_GPIO_PULL_DOWN));//PB3????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_6 * GPIO_PIN_6) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_6 * GPIO_PIN_6) * LL_GPIO_PULL_DOWN));//PB6????
    MODIFY_REG(GPIOF->PUPDR, ((GPIO_PIN_1 * GPIO_PIN_1) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_1 * GPIO_PIN_1) * LL_GPIO_PULL_DOWN));//PF1????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_4 * GPIO_PIN_4) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_4 * GPIO_PIN_4) * LL_GPIO_PULL_DOWN));//PB4????
    MODIFY_REG(GPIOB->PUPDR, ((GPIO_PIN_5 * GPIO_PIN_5) * GPIO_PUPDR_PUPD0), ((GPIO_PIN_5 * GPIO_PIN_5) * LL_GPIO_PULL_DOWN));//PB5????

    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_7 * GPIO_PIN_7) * GPIO_MODER_MODE0), ((GPIO_PIN_7 * GPIO_PIN_7) * LL_GPIO_MODE_ALTERNATE));//PB7->PWM????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_3 * GPIO_PIN_3) * GPIO_MODER_MODE0), ((GPIO_PIN_3 * GPIO_PIN_3) * LL_GPIO_MODE_ALTERNATE));//PB3->PWM????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_6 * GPIO_PIN_6) * GPIO_MODER_MODE0), ((GPIO_PIN_6 * GPIO_PIN_6) * LL_GPIO_MODE_ALTERNATE));//PB6->PWM????
    MODIFY_REG(GPIOF->MODER, ((GPIO_PIN_1 * GPIO_PIN_1) * GPIO_MODER_MODE0), ((GPIO_PIN_1 * GPIO_PIN_1) * LL_GPIO_MODE_ALTERNATE));//PF1->PWM????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_4 * GPIO_PIN_4) * GPIO_MODER_MODE0), ((GPIO_PIN_4 * GPIO_PIN_4) * LL_GPIO_MODE_ALTERNATE));//PB4->PWM????
    MODIFY_REG(GPIOB->MODER, ((GPIO_PIN_5 * GPIO_PIN_5) * GPIO_MODER_MODE0), ((GPIO_PIN_5 * GPIO_PIN_5) * LL_GPIO_MODE_ALTERNATE));//PB5->PWM????

    //mc_stFoc2R.testCode = 1500;//测试
}
void MC_6StepPulse(void)
{
#if 1
    if(mc_stFoc2R.SixStep_ID < 1 || mc_stFoc2R.SixStep_ID > 7)
        return ;

    //****************************************************//
    // BLDC PWM Control for each step
    //****************************************************//
    if (mc_stFoc2R.SixStep_ID == 1)
    {   // U--W
        PwmUH_ONN;
        PwmVH_OFF;
        PwmWH_OFF;

        PwmUL_OFF;
        PwmVL_OFF;
        PwmWL_ONN;
    }
    else if (mc_stFoc2R.SixStep_ID == 2)
    {   // W--U
        PwmUH_OFF;
        PwmVH_OFF;
        PwmWH_ONN;

        PwmUL_ONN;
        PwmVL_OFF;
        PwmWL_OFF;
    }

    else if (mc_stFoc2R.SixStep_ID == 3)
    {   // V--W
        PwmUH_OFF;
        PwmVH_ONN;
        PwmWH_OFF;

        PwmUL_OFF;
        PwmVL_OFF;
        PwmWL_ONN;
    }
    else if (mc_stFoc2R.SixStep_ID == 4)
    {   // W--V
        PwmUH_OFF;
        PwmVH_OFF;
        PwmWH_ONN;

        PwmUL_OFF;
        PwmVL_ONN;
        PwmWL_OFF;
    }

    else if (mc_stFoc2R.SixStep_ID == 5)
    {   // V--U
        PwmUH_OFF;
        PwmVH_ONN;
        PwmWH_OFF;

        PwmUL_ONN;
        PwmVL_OFF;
        PwmWL_OFF;
    }

    else if (mc_stFoc2R.SixStep_ID == 6)
    {   // U--V
        PwmUH_ONN;
        PwmVH_OFF;
        PwmWH_OFF;

        PwmUL_OFF;
        PwmVL_ONN;
        PwmWL_OFF;
    }
    else
    {
        PwmUH_OFF;
        PwmVH_OFF;
        PwmWH_OFF;

        PwmUL_OFF;
        PwmVL_OFF;
        PwmWL_OFF;

        MC_6Step_Io_Pwm();		//IO??????PWM????
    }

    while (TIM1->CNT < 1600);//???????
    PwmUH_OFF;
    PwmVH_OFF;
    PwmWH_OFF;
    PwmUL_OFF;
    PwmVL_OFF;
    PwmWL_OFF;

    mc_stFoc2R.SixStep_ID += 1;

#endif
}

/********************************************************************************
Description:    
Input:
Output:
Return:
*********************************************************************************/
void PUYA_SEMI_MC_FOC1R_PI_Ctrl(PUYA_SEMI_MC_FOC1R_PI_TYPE *stPI)
{
	stPI->ek=stPI->Ref-stPI->Yk;
	stPI->dek=stPI->ek-stPI->ek_1;

	stPI->slOut.sl=(int32_t)stPI->swOut+((int32_t)(stPI->Kp)*stPI->dek>>11)+((int32_t)(stPI->Ki)*stPI->ek>>13);
	
	if(stPI->slOut.sl>stPI->Max)
		stPI->swOut=stPI->Max;
	else if(stPI->slOut.sl>stPI->Min)
		stPI->swOut=stPI->slOut.sw.low;
	else
		stPI->swOut=stPI->Min;
	
	stPI->ek_1=stPI->ek;
}

/*************************************************************************
 End of this File (EOF):
 Do not put anything after this part!
*************************************************************************/
